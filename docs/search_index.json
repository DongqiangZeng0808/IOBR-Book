[["index.html", "IOBR (Immuno-Oncology Biological Research) Introduction 0.1  Introduction 0.2  License 0.3  Publishment 0.4 ⏳ Major Updates 0.5 ✉️ Reporting bugs", " IOBR (Immuno-Oncology Biological Research) Dongqiang Zeng 2023-09-08 Introduction Preface Figure 0.1: The workflow of IOBR 0.1  Introduction IOBR is design for Immuno-Oncology Biological Research. Recent advance in next-generation sequencing has triggered the rapidly accumulating publicly available multi-omics data. The application of integrated omics to exploring robust signatures for clinical translation is increasingly highlighted in immuno-oncology but raises computational and biological challenges. This vignette aims to demonstrate how to utilize the package named IOBR to perform multi-omics immuno-oncology biological research to decode tumor microenvironment and signatures for clinical translation. This R package integrates 8 published methodologies for decoding tumor microenvironment (TME) contexture: CIBERSORT, TIMER, xCell, MCPcounter, ESITMATE, EPIC, IPS, quanTIseq. Moreover, 255 published signature gene sets were collected by IOBR, involving tumor microenvironment, tumor metabolism, m6A, exosomes, microsatellite instability, and tertiary lymphoid structure. Run the function signature_collection_citation to obtain the source papers, and the function signature_collection returns the detail signature genes of all given signatures. Subsequently, IOBR adopts three computational methods to calculate the signature score, comprising PCA, z-score, and ssGSEA. To note, IOBR collected and employed multiple approaches for variable transition, visualization, batch survival analysis, feature selection, and statistical analysis. Batch analysis and visualization of corresponding results are supported. The details of how IOBR works are described below. 0.2  License IOBR is released under the GPL v3.0 license. See LICENSE for details. The code contained in this book is simultaneously available under the GPL license; this means that you are free to use it in your packages, as long as you cite the source. The online version of this book is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. 0.3  Publishment Zeng D, Ye Z, Shen R, Yu G, Wu J, Xiong Y,…, Liao W (2021) IOBR: Multi-Omics Immuno-Oncology Biological Research to Decode Tumor Microenvironment and Signatures. Frontiers in Immunology. 12:687975. doi: 10.3389/fimmu.2021.687975 0.4 ⏳ Major Updates Figure 0.2: The workflow of IOBR 0.5 ✉️ Reporting bugs Please report bugs to the Github issues page E-mail any questions to dongqiangzeng0808@gmail.com "],["how-to-install-iobr.html", "Chapter 1 How to install IOBR 1.1 ⏳ Install Dependency Packages 1.2  Install IOBR package 1.3  How to update IOBR 1.4  The main pipeline of IOBR 1.5  Main Functions of IOBR 1.6  Current working environment", " Chapter 1 How to install IOBR 1.1 ⏳ Install Dependency Packages It is essential that you have R 3.6.3 or above already installed on your computer or server. IOBR is a pipeline that utilizes many other R packages that are currently available from CRAN, Bioconductor and GitHub. if (!requireNamespace(&quot;BiocManager&quot;, quietly = TRUE)) install.packages(&quot;BiocManager&quot;) depens&lt;-c(&#39;tibble&#39;, &#39;survival&#39;, &#39;survminer&#39;, &#39;limma&#39;, &quot;DESeq2&quot;,&quot;devtools&quot;, &#39;limSolve&#39;, &#39;GSVA&#39;, &#39;e1071&#39;, &#39;preprocessCore&#39;, &quot;devtools&quot;, &quot;tidyHeatmap&quot;, &quot;caret&quot;, &quot;glmnet&quot;, &quot;ppcor&quot;, &quot;timeROC&quot;, &quot;pracma&quot;, &quot;factoextra&quot;, &quot;FactoMineR&quot;, &quot;WGCNA&quot;, &quot;patchwork&quot;, &#39;ggplot2&#39;, &quot;biomaRt&quot;, &#39;ggpubr&#39;) for(i in 1:length(depens)){ depen&lt;-depens[i] if (!requireNamespace(depen, quietly = TRUE)) BiocManager::install(depen,update = FALSE) } 1.2  Install IOBR package When the dependent environments are built, users are able to install IOBR from github by typing the following code into your R session: if (!requireNamespace(&quot;IOBR&quot;, quietly = TRUE)) devtools::install_github(&quot;IOBR/IOBR&quot;) library(IOBR) 1.3  How to update IOBR detach(&quot;package:IOBR&quot;) path&lt;-.libPaths() remove.packages(c(&#39;IOBR&#39;), lib=file.path(path)) devtools::install_github(&quot;IOBR/IOBR&quot;) 1.4  The main pipeline of IOBR Figure 1.1: The main pipeline of IOBR 1.5  Main Functions of IOBR Data Preparation: data annotation and transformation count2tpm(): transform count data of RNA sequencing into TPM data. anno_eset(): annotate the normalized genes expression matrix, including RNAseq and array (Affymetrix or Illumina). remove_duplicate_genes(): remove the genes annotated with the duplicated symbol after normalization and retain only the symbol with highest expression level. mouse2human_eset(): Converting muouse gene symbol to human gene symbol of expression set. find_outlier_samples(): Waiting for updates… remove_batcheffect(): Waiting for updates… TME Deconvolution Module: integrate multiple algorithms to decode immune contexture deconvo_tme(): decode the TME infiltration with different deconvolution methodologies, based on bulk RNAseq, microarray or single cell RNAseq data. generateRef(): generate a novel gene reference matrix for a specific feature such as infiltrating cell, through the SVR and lsei algorithm. Signature Module: calculatint signature scores, estimate phenotype related signatures and corresponding genes, and evaluate signatures generated from single-cell RNA sequencing data calculate_sig_score(): estimate the interested signatures enrolled in IOBR R package, which involves TME-associated, tumor-metabolism, and tumor-intrinsic signatures. feature_manipulation(): manipulate features including the cell fraction and signatures generated from multi-omics data for latter analysis and model construction. Remove missing values, outliers and variables without significant variance. format_signatures(): generate the object for calculate_sig_score() function, by inputting a data frame with signatures as column names of corresponding gene sets, and return a list contain the signature information for calculating multiple signature scores. format_msigdb(): transform the signature gene sets data with gmt format, which is not included in the signature collection and might be downloaded in the MSgiDB website, into the object of calculate_sig_score()function. sig_gsea(): Waiting for updates… Batch Analysis and Visualization: batch survival analysis and batch correlation analysis and other batch statistical analyses batch_surv(): batch survival analysis of multiple continuous variables including varied signature scores. subgroup_survival(): batch survival analysis of multiple categorized variables with different number of subgroups. batch_cor(): batch analysis of correlation between two continuous variables using Pearson correlation coefficient or Spearman’s rank correlation coefficient . batch_wilcoxon(): conduct batch wilcoxon analyses of binary variables. batch_pcc(): batch analyses of Partial Correlation coefficient(PCC) between continuous variables and minimize the interference derived from confounding factors. iobr_cor_plot(): visualization of batch correlation analysis of signatures from ‘sig_group’. Visualize the correlation between signature or phenotype with expression of gene sets in target signature is also supported. cell_bar_plot(): batch visualization of TME cell fraction, supporting input of deconvolution results from ‘CIBERSORT’, ‘EPIC’ and ‘quanTIseq’ methodologies to further compare the TME cell distributions within one sample or among different samples. iobr_pca(): The iobr_pca function performs Principal Component Analysis (PCA), which reduces the dimensionality of data while maintaining most of the original variance, and visualizes the PCA results on a scatter plot. iobr_cor_plot(): Integrative correlation between phenotype and features. iobr_deg(): Waiting for updates… get_cor(): Waiting for updates… roc_time(): Waiting for updates… sig_box(): Waiting for updates… sig_heatmap(): Waiting for updates… sig_forest(): Waiting for updates… sig_roc(): Waiting for updates… sig_surv_plot(): Waiting for updates… find_markers_in_bulk(): Waiting for updates… Signature Associated Mutation Module: identify and analyze mutations relevant to targeted signatures make_mut_matrix(): transform the mutation data with MAF format(contain the columns of gene ID and the corresponding gene alterations which including SNP, indel and frameshift) into a mutation matrix in a suitable manner for further investigating signature relevant mutations. find_mutations(): identify mutations associated with a distinct phenotype or signature. Model Construction Module: feature selection and fast model construct to predict clinical phenotype BinomialModel(): select features and construct a model to predict a binary phenotype. PrognosticMode(): select features and construct a model to predict clinical survival outcome. 1.6  Current working environment sessionInfo() ## R version 4.2.0 (2022-04-22 ucrt) ## Platform: x86_64-w64-mingw32/x64 (64-bit) ## Running under: Windows 10 x64 (build 19045) ## ## Matrix products: default ## ## locale: ## [1] LC_COLLATE=Chinese (Simplified)_China.utf8 ## [2] LC_CTYPE=Chinese (Simplified)_China.utf8 ## [3] LC_MONETARY=Chinese (Simplified)_China.utf8 ## [4] LC_NUMERIC=C ## [5] LC_TIME=Chinese (Simplified)_China.utf8 ## ## attached base packages: ## [1] grid stats graphics grDevices utils datasets methods ## [8] base ## ## other attached packages: ## [1] IOBR_0.99.9 survminer_0.4.9 patchwork_1.1.1 ## [4] clusterProfiler_4.4.3 survival_3.3-1 ggpubr_0.4.0 ## [7] ggplot2_3.4.2 dplyr_1.1.2 tibble_3.2.1 ## [10] tidyHeatmap_1.8.1 ComplexHeatmap_2.15.4 ## ## loaded via a namespace (and not attached): ## [1] utf8_1.2.2 tidyselect_1.2.0 ## [3] RSQLite_2.2.14 AnnotationDbi_1.58.0 ## [5] BiocParallel_1.30.3 lpSolve_5.6.15 ## [7] scatterpie_0.1.7 ScaledMatrix_1.4.0 ## [9] munsell_0.5.0 codetools_0.2-18 ## [11] preprocessCore_1.58.0 withr_2.5.0 ## [13] colorspace_2.0-3 GOSemSim_2.22.0 ## [15] Biobase_2.56.0 limSolve_1.5.6 ## [17] highr_0.9 knitr_1.39 ## [19] rstudioapi_0.13 SingleCellExperiment_1.18.0 ## [21] stats4_4.2.0 ggsignif_0.6.3 ## [23] DOSE_3.22.0 MatrixGenerics_1.8.0 ## [25] GenomeInfoDbData_1.2.8 KMsurv_0.1-5 ## [27] polyclip_1.10-0 bit64_4.0.5 ## [29] farver_2.1.0 rhdf5_2.40.0 ## [31] downloader_0.4 treeio_1.21.2 ## [33] vctrs_0.6.2 generics_0.1.3 ## [35] xfun_0.40 R6_2.5.1 ## [37] doParallel_1.0.17 GenomeInfoDb_1.34.4 ## [39] clue_0.3-61 graphlayouts_0.8.0 ## [41] rsvd_1.0.5 locfit_1.5-9.5 ## [43] rhdf5filters_1.8.0 gridGraphics_0.5-1 ## [45] bitops_1.0-7 cachem_1.0.6 ## [47] fgsea_1.22.0 DelayedArray_0.22.0 ## [49] assertthat_0.2.1 scales_1.2.0 ## [51] ggraph_2.0.5 enrichplot_1.16.1 ## [53] googlesheets4_1.0.0 gtable_0.3.1 ## [55] beachmat_2.12.0 tidygraph_1.2.1 ## [57] rlang_1.1.0 genefilter_1.78.0 ## [59] GlobalOptions_0.1.2 splines_4.2.0 ## [61] lazyeval_0.2.2 rstatix_0.7.0 ## [63] gargle_1.2.0 broom_0.8.0 ## [65] yaml_2.3.5 reshape2_1.4.4 ## [67] abind_1.4-5 modelr_0.1.8 ## [69] backports_1.4.1 qvalue_2.28.0 ## [71] tools_4.2.0 bookdown_0.35 ## [73] ggplotify_0.1.0 ellipsis_0.3.2 ## [75] jquerylib_0.1.4 RColorBrewer_1.1-3 ## [77] proxy_0.4-27 BiocGenerics_0.42.0 ## [79] Rcpp_1.0.9 plyr_1.8.7 ## [81] sparseMatrixStats_1.8.0 zlibbioc_1.42.0 ## [83] purrr_0.3.4 RCurl_1.98-1.7 ## [85] GetoptLong_1.0.5 viridis_0.6.2 ## [87] cowplot_1.1.1 S4Vectors_0.34.0 ## [89] zoo_1.8-10 SummarizedExperiment_1.26.1 ## [91] haven_2.5.0 ggrepel_0.9.1 ## [93] cluster_2.1.3 fs_1.5.2 ## [95] magrittr_2.0.3 data.table_1.14.2 ## [97] DO.db_2.9 circlize_0.4.15 ## [99] reprex_2.0.1 googledrive_2.0.0 ## [101] matrixStats_0.62.0 GSVA_1.44.2 ## [103] hms_1.1.1 evaluate_0.15 ## [105] xtable_1.8-4 XML_3.99-0.10 ## [107] readxl_1.4.0 IRanges_2.30.0 ## [109] gridExtra_2.3 shape_1.4.6 ## [111] compiler_4.2.0 shadowtext_0.1.2 ## [113] crayon_1.5.2 htmltools_0.5.2 ## [115] ggfun_0.0.6 tzdb_0.3.0 ## [117] aplot_0.1.6 tidyr_1.2.0 ## [119] geneplotter_1.74.0 lubridate_1.8.0 ## [121] DBI_1.1.2 tweenr_1.0.2 ## [123] corrplot_0.92 dbplyr_2.2.0 ## [125] MASS_7.3-56 Matrix_1.5-4.1 ## [127] car_3.1-0 readr_2.1.2 ## [129] cli_3.4.1 quadprog_1.5-8 ## [131] parallel_4.2.0 igraph_1.3.2 ## [133] GenomicRanges_1.48.0 forcats_0.5.1 ## [135] pkgconfig_2.0.3 km.ci_0.5-6 ## [137] xml2_1.3.3 foreach_1.5.2 ## [139] ggtree_3.4.4 annotate_1.74.0 ## [141] bslib_0.3.1 XVector_0.36.0 ## [143] rvest_1.0.2 yulab.utils_0.0.4 ## [145] stringr_1.4.0 digest_0.6.29 ## [147] graph_1.74.0 Biostrings_2.64.0 ## [149] rmarkdown_2.14 cellranger_1.1.0 ## [151] fastmatch_1.1-3 tidytree_0.3.9 ## [153] survMisc_0.5.6 dendextend_1.15.2 ## [155] DelayedMatrixStats_1.18.0 GSEABase_1.58.0 ## [157] rjson_0.2.21 nlme_3.1-157 ## [159] lifecycle_1.0.3 jsonlite_1.8.0 ## [161] Rhdf5lib_1.18.2 carData_3.0-5 ## [163] viridisLite_0.4.1 limma_3.52.1 ## [165] fansi_1.0.3 pillar_1.9.0 ## [167] lattice_0.20-45 KEGGREST_1.36.2 ## [169] fastmap_1.1.0 httr_1.4.3 ## [171] GO.db_3.15.0 emo_0.0.0.9000 ## [173] glue_1.6.2 png_0.1-7 ## [175] iterators_1.0.14 glmnet_4.1-4 ## [177] bit_4.0.4 HDF5Array_1.24.1 ## [179] ggforce_0.3.3 class_7.3-20 ## [181] stringi_1.7.6 sass_0.4.1 ## [183] blob_1.2.3 BiocSingular_1.12.0 ## [185] DESeq2_1.36.0 memoise_2.0.1 ## [187] irlba_2.3.5 ape_5.6-2 ## [189] tidyverse_1.3.2 e1071_1.7-11 "],["rna-data-preprocessing.html", "Chapter 2 RNA Data preprocessing 2.1 Loading packages 2.2 Download array data using GEOquery 2.3 Gene Annotation 2.4 Identifying outlier samples 2.5 PCA analysis of molecular subtypes 2.6 Batch effect correction 2.7 References", " Chapter 2 RNA Data preprocessing 2.1 Loading packages Load the IOBR package in your R session after the installation is complete: library(IOBR) library(tidyverse) library(clusterProfiler) 2.2 Download array data using GEOquery Obtaining data set from GEO Gastric cancer: GSE62254 using GEOquery R package. if (!requireNamespace(&quot;GEOquery&quot;, quietly = TRUE)) BiocManager::install(&quot;GEOquery&quot;) library(&quot;GEOquery&quot;) # NOTE: This process may take a few minutes which depends on the internet connection speed. Please wait for its completion. eset_geo&lt;-getGEO(GEO = &quot;GSE62254&quot;, getGPL = F, destdir = &quot;./&quot;) eset &lt;-eset_geo[[1]] eset &lt;-exprs(eset) eset[1:5,1:5] ## GSM1523727 GSM1523728 GSM1523729 GSM1523744 GSM1523745 ## 1007_s_at 3.2176645 3.0624323 3.0279131 2.921683 2.8456013 ## 1053_at 2.4050109 2.4394879 2.2442708 2.345916 2.4328582 ## 117_at 1.4933412 1.8067380 1.5959665 1.839822 1.8326058 ## 121_at 2.1965561 2.2812181 2.1865556 2.258599 2.1874363 ## 1255_g_at 0.8698382 0.9502466 0.8125414 1.012860 0.9441993 2.3 Gene Annotation Annotation of genes in the expression matrix and removal of duplicate genes. # Load the annotation file `anno_hug133plus2` in IOBR. head(anno_hug133plus2) ## # A tibble: 6 × 2 ## probe_id symbol ## &lt;fct&gt; &lt;fct&gt; ## 1 1007_s_at MIR4640 ## 2 1053_at RFC2 ## 3 117_at HSPA6 ## 4 121_at PAX8 ## 5 1255_g_at GUCA1A ## 6 1294_at MIR5193 # Load the annotation file `anno_grch38` in IOBR. head(anno_grch38) ## id eff_length gc entrez symbol chr start end ## 1 ENSG00000000003 4536 0.3992504 7105 TSPAN6 X 100627109 100639991 ## 2 ENSG00000000005 1476 0.4241192 64102 TNMD X 100584802 100599885 ## 3 ENSG00000000419 9276 0.4252911 8813 DPM1 20 50934867 50958555 ## 4 ENSG00000000457 6883 0.4117391 57147 SCYL3 1 169849631 169894267 ## 5 ENSG00000000460 5970 0.4298157 55732 C1orf112 1 169662007 169854080 ## 6 ENSG00000000938 3382 0.5644589 2268 FGR 1 27612064 27635277 ## strand biotype ## 1 -1 protein_coding ## 2 1 protein_coding ## 3 -1 protein_coding ## 4 -1 protein_coding ## 5 1 protein_coding ## 6 -1 protein_coding ## description ## 1 tetraspanin 6 [Source:HGNC Symbol;Acc:HGNC:11858] ## 2 tenomodulin [Source:HGNC Symbol;Acc:HGNC:17757] ## 3 dolichyl-phosphate mannosyltransferase polypeptide 1, catalytic subunit [Source:HGNC Symbol;Acc:HGNC:3005] ## 4 SCY1-like, kinase-like 3 [Source:HGNC Symbol;Acc:HGNC:19285] ## 5 chromosome 1 open reading frame 112 [Source:HGNC Symbol;Acc:HGNC:25565] ## 6 FGR proto-oncogene, Src family tyrosine kinase [Source:HGNC Symbol;Acc:HGNC:3697] # Load the annotation file `anno_gc_vm32` in IOBR for mouse RNAseq data head(anno_gc_vm32) ## id eff_length gc symbol mgi_id gene_type ## 1 ENSMUSG00000000001 3262 0.4350092 Gnai3 MGI:95773 protein_coding ## 2 ENSMUSG00000000003 902 0.3481153 Pbsn MGI:1860484 protein_coding ## 3 ENSMUSG00000000028 3506 0.4962921 Cdc45 MGI:1338073 protein_coding ## 4 ENSMUSG00000000031 2625 0.5588571 H19 MGI:95891 lncRNA ## 5 ENSMUSG00000000037 6397 0.4377052 Scml2 MGI:1340042 protein_coding ## 6 ENSMUSG00000000049 1594 0.5050188 Apoh MGI:88058 protein_coding ## start end transcript_id ont ## 1 108014596 108053462 &lt;NA&gt; &lt;NA&gt; ## 2 76881507 76897229 &lt;NA&gt; &lt;NA&gt; ## 3 18599197 18630737 &lt;NA&gt; &lt;NA&gt; ## 4 142129262 142131886 &lt;NA&gt; &lt;NA&gt; ## 5 159865521 160041209 &lt;NA&gt; &lt;NA&gt; ## 6 108234180 108305222 &lt;NA&gt; &lt;NA&gt; 2.3.1 For Array data: HGU133PLUS-2 (Affaymetrix) # Conduct gene annotation using `anno_hug133plus2` file; If identical gene symbols exists, these genes would be ordered by the mean expression levels. The gene symbol with highest mean expression level is selected and remove others. eset&lt;-anno_eset(eset = eset, annotation = anno_hug133plus2, symbol = &quot;symbol&quot;, probe = &quot;probe_id&quot;, method = &quot;mean&quot;) eset[1:5, 1:3] ## GSM1523727 GSM1523728 GSM1523729 ## SH3KBP1 4.327974 4.316195 4.351425 ## RPL41 4.246149 4.246808 4.257940 ## EEF1A1 4.293762 4.291038 4.262199 ## COX2 4.250288 4.283714 4.270508 ## LOC101928826 4.219303 4.219670 4.213252 2.3.2 For RNAseq data Download RNAseq data using UCSCXenaTools if (!requireNamespace(&quot;UCSCXenaTools&quot;, quietly = TRUE)) BiocManager::install(&quot;UCSCXenaTools&quot;) library(UCSCXenaTools) # NOTE: This process may take a few minutes which depends on the internet connection speed. Please wait for its completion. eset_stad&lt;-XenaGenerate(subset = XenaCohorts ==&quot;GDC TCGA Stomach Cancer (STAD)&quot;) %&gt;% XenaFilter(filterDatasets = &quot;TCGA-STAD.htseq_counts.tsv&quot;) %&gt;% XenaQuery() %&gt;% XenaDownload() %&gt;% XenaPrepare() eset_stad[1:5, 1:3] Transform gene expression matrix into TPM format, and conduct subsequent annotation. # Remove the version numbers in Ensembl ID. eset_stad$Ensembl_ID&lt;-substring(eset_stad$Ensembl_ID, 1, 15) eset_stad&lt;-column_to_rownames(eset_stad, var = &quot;Ensembl_ID&quot;) # Revert back to original format because the data from UCSC was log2(x+1)transformed. eset_stad&lt;-(2^eset_stad)+1 eset_stad&lt;-count2tpm(countMat = eset_stad, idType = &quot;Ensembl&quot;, org=&quot;hsa&quot;, source = &quot;local&quot; ) eset_stad[1:5,1:5] 2.4 Identifying outlier samples Take ACRG microarray data for example res &lt;- find_outlier_samples(eset = eset, project = &quot;ACRG&quot;, show_plot = TRUE) ## [1] &quot;GSM1523817&quot; &quot;GSM1523858&quot; &quot;GSM1523984&quot; &quot;GSM1523988&quot; &quot;GSM1524030&quot; Removing potential outlier samples eset1 &lt;- eset[, !colnames(eset)%in%res] 2.5 PCA analysis of molecular subtypes data(&quot;pdata_acrg&quot;) res&lt;- iobr_pca(data = eset1, is.matrix = TRUE, scale = TRUE, is.log = FALSE, pdata = pdata_acrg, id_pdata = &quot;ID&quot;, group = &quot;Subtype&quot;, geom.ind = &quot;point&quot;, cols = &quot;normal&quot;, palette = &quot;jama&quot;, repel = FALSE, ncp = 5, axes = c(1, 2), addEllipses = TRUE) ## ## CIN EBV EMT GS MSI MSS/TP53- MSS/TP53+ ## 0 0 42 0 68 106 79 ## [1] &quot;&gt;&gt;-- colors for PCA: #374E55FF&quot; &quot;&gt;&gt;-- colors for PCA: #DF8F44FF&quot; ## [3] &quot;&gt;&gt;-- colors for PCA: #00A1D5FF&quot; &quot;&gt;&gt;-- colors for PCA: #B24745FF&quot; res 2.6 Batch effect correction Obtaining another data set from GEO Gastric cancer: GSE57303 using GEOquery R package. # NOTE: This process may take a few minutes which depends on the internet connection speed. Please wait for its completion. eset_geo&lt;-getGEO(GEO = &quot;GSE57303&quot;, getGPL = F, destdir = &quot;./&quot;) eset2 &lt;-eset_geo[[1]] eset2 &lt;-exprs(eset2) eset2[1:5,1:5] ## GSM1379261 GSM1379262 GSM1379263 GSM1379264 GSM1379265 ## 1007_s_at 8.34746 9.67994 8.62643 8.59301 8.63046 ## 1053_at 5.07972 4.46377 5.29685 5.78983 4.33359 ## 117_at 5.65558 4.48732 4.21615 5.47984 5.20816 ## 121_at 5.95123 7.09056 6.19903 5.89872 5.91323 ## 1255_g_at 1.66923 1.98758 1.73083 1.56687 1.63332 Annotation of genes in the expression matrix and removal of duplicate genes. eset2&lt;-anno_eset(eset = eset2, annotation = anno_hug133plus2, symbol = &quot;symbol&quot;, probe = &quot;probe_id&quot;, method = &quot;mean&quot;) eset2[1:5, 1:5] ## GSM1379261 GSM1379262 GSM1379263 GSM1379264 GSM1379265 ## ND4 13.1695 13.1804 13.0600 12.4544 13.0457 ## ATP6 13.1433 13.0814 13.0502 12.4831 13.1168 ## SH3KBP1 12.9390 13.1620 12.9773 12.8745 13.1169 ## COX2 13.0184 13.0489 12.8621 12.7489 12.9732 ## RPL41 13.0201 12.6034 12.7929 13.0153 12.9404 eset_com &lt;- remove_batcheffect( eset1 = eset1, eset2 = eset2, eset3 = NULL, id_type = &quot;symbol&quot;, data_type = &quot;array&quot;, cols = &quot;normal&quot;, palette = &quot;jama&quot;, log2 = TRUE, check_eset = TRUE, adjust_eset = TRUE, repel = FALSE, path = &quot;result&quot;) ## ## eset1 eset2 ## 295 70 ## [1] &quot;&gt;&gt;-- colors for PCA: #374E55FF&quot; &quot;&gt;&gt;-- colors for PCA: #DF8F44FF&quot; ## ## eset1 eset2 ## 295 70 ## [1] &quot;&gt;&gt;-- colors for PCA: #374E55FF&quot; &quot;&gt;&gt;-- colors for PCA: #DF8F44FF&quot; dim(eset_com) ## [1] 21752 365 Waiting for updates: Removing batch effect of RNAseq datasets: count, combat-seq 2.7 References Wang et al., (2019). The UCSCXenaTools R package: a toolkit for accessing genomics data from UCSC Xena platform, from cancer multi-omics to single-cell RNA-seq. Journal of Open Source Software, 4(40), 1627, https://doi.org/10.21105/joss.01627 Yuqing Zhang and others, ComBat-seq: batch effect adjustment for RNA-seq count data, NAR Genomics and Bioinformatics, Volume 2, Issue 3, September 2020, lqaa078, https://doi.org/10.1093/nargab/lqaa078 Leek, J. T., Johnson, W. E., Parker, H. S., Jaffe, A. E., &amp; Storey, J. D. (2012). The sva package for removing batch effects and other unwanted variation in high-throughput experiments. Bioinformatics, 28(6), 882-883. "],["tumor-ecosystem-analysis.html", "Chapter 3 Tumor ecosystem analysis 3.1 Loading packages 3.2 Downloading data for example 3.3 Gene Annotation: HGU133PLUS-2 (Affaymetrix) 3.4 Determine TME subtype of gastric cancer using TMEclassifier R package 3.5 DEG analysis: method1 3.6 GSEA analysis based on differential express gene analysis results 3.7 DEG analysis: method2 3.8 Identifying signatures associated with TME clusters", " Chapter 3 Tumor ecosystem analysis 3.1 Loading packages library(IOBR) 3.2 Downloading data for example Obtaining data set from GEO Gastric cancer: GSE62254 using GEOquery R package. if (!requireNamespace(&quot;GEOquery&quot;, quietly = TRUE)) BiocManager::install(&quot;GEOquery&quot;) library(&quot;GEOquery&quot;) # NOTE: This process may take a few minutes which depends on the internet connection speed. Please wait for its completion. eset_geo&lt;-getGEO(GEO = &quot;GSE62254&quot;, getGPL = F, destdir = &quot;./&quot;) eset &lt;-eset_geo[[1]] eset &lt;-exprs(eset) eset[1:5,1:5] ## GSM1523727 GSM1523728 GSM1523729 GSM1523744 GSM1523745 ## 1007_s_at 3.2176645 3.0624323 3.0279131 2.921683 2.8456013 ## 1053_at 2.4050109 2.4394879 2.2442708 2.345916 2.4328582 ## 117_at 1.4933412 1.8067380 1.5959665 1.839822 1.8326058 ## 121_at 2.1965561 2.2812181 2.1865556 2.258599 2.1874363 ## 1255_g_at 0.8698382 0.9502466 0.8125414 1.012860 0.9441993 3.3 Gene Annotation: HGU133PLUS-2 (Affaymetrix) # Conduct gene annotation using `anno_hug133plus2` file; If identical gene symbols exists, these genes would be ordered by the mean expression levels. The gene symbol with highest mean expression level is selected and remove others. eset&lt;-anno_eset(eset = eset, annotation = anno_hug133plus2, symbol = &quot;symbol&quot;, probe = &quot;probe_id&quot;, method = &quot;mean&quot;) eset[1:5, 1:3] ## GSM1523727 GSM1523728 GSM1523729 ## SH3KBP1 4.327974 4.316195 4.351425 ## RPL41 4.246149 4.246808 4.257940 ## EEF1A1 4.293762 4.291038 4.262199 ## COX2 4.250288 4.283714 4.270508 ## LOC101928826 4.219303 4.219670 4.213252 3.4 Determine TME subtype of gastric cancer using TMEclassifier R package library(TMEclassifier) tme &lt;- tme_classifier(eset = eset, scale = TRUE) ## Step-1: Expression data preprocessing... ## Step-2: TME deconvolution... ## Step-3: Predicting TME phenotypes... ## [19:12:57] WARNING: amalgamation/../src/learner.cc:1040: ## If you are loading a serialized model (like pickle in Python, RDS in R) generated by ## older XGBoost, please export the model by calling `Booster.save_model` from that version ## first, then load it back in current version. See: ## ## https://xgboost.readthedocs.io/en/latest/tutorials/saving_model.html ## ## for more details about differences between saving model and serializing. ## ## [19:12:57] WARNING: amalgamation/../src/learner.cc:749: Found JSON model saved before XGBoost 1.6, please save the model using current version again. The support for old JSON model will be discontinued in XGBoost 2.3. ## &gt;&gt;&gt;--- DONE! table(tme$TMEcluster) ## ## IA IE IS ## 107 96 97 head(tme) ## ID IE IS IA TMEcluster ## 1 GSM1523727 0.204623557 0.11212681 0.68324962 IA ## 2 GSM1523728 0.009599504 0.11179146 0.87860903 IA ## 3 GSM1523729 0.852615046 0.11369089 0.03369407 IE ## 4 GSM1523744 0.053842233 0.06994632 0.87621145 IA ## 5 GSM1523745 0.055973019 0.80839488 0.13563209 IS ## 6 GSM1523746 0.545343299 0.37437568 0.08028102 IE table(tme$TMEcluster) ## ## IA IE IS ## 107 96 97 head(tme) ## ID IE IS IA TMEcluster ## 1 GSM1523727 0.204623557 0.11212681 0.68324962 IA ## 2 GSM1523728 0.009599504 0.11179146 0.87860903 IA ## 3 GSM1523729 0.852615046 0.11369089 0.03369407 IE ## 4 GSM1523744 0.053842233 0.06994632 0.87621145 IA ## 5 GSM1523745 0.055973019 0.80839488 0.13563209 IS ## 6 GSM1523746 0.545343299 0.37437568 0.08028102 IE 3.5 DEG analysis: method1 Differential analysis of selected immune-activated and immune-expelled gastric cancers pdata &lt;- tme[!tme$TMEcluster==&quot;IS&quot;, ] deg &lt;- iobr_deg(eset = eset, annotation = NULL, pdata = pdata, group_id = &quot;TMEcluster&quot;, pdata_id = &quot;ID&quot;, array = TRUE, method = &quot;limma&quot;, contrast = c(&quot;IA&quot;,&quot;IE&quot;), path = NULL, padj_cutoff = 0.01, logfc_cutoff = 0.5) ## &gt;&gt;&gt;== Matching grouping information and expression matrix ## &gt;&gt;&gt;== limma was selected for differential gene analysis of Array data ## ## Attaching package: &#39;limma&#39; ## The following object is masked from &#39;package:BiocGenerics&#39;: ## ## plotMA ## group1 = IE ## group2 = NA ## # A tibble: 6 × 11 ## symbol log2FoldChange AveExpr t pvalue padj B sigORnot label ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; ## 1 TMEM100 0.774 1.84 13.9 2.47e-31 5.37e-27 60.4 Up_regulat… Both ## 2 ABCA8 0.933 1.90 12.9 3.11e-28 3.38e-24 53.4 Up_regulat… Both ## 3 HHIP 0.613 1.73 12.1 7.62e-26 4.46e-22 48.0 Up_regulat… Both ## 4 LMNB2 -0.287 2.25 -12.1 9.28e-26 4.46e-22 47.8 NOT Sign… ## 5 MCM6 -0.211 3.02 -12.1 1.02e-25 4.46e-22 47.7 NOT Sign… ## 6 ADH1B 0.907 1.86 12.0 2.27e-25 7.04e-22 47.0 Up_regulat… Both ## # ℹ 2 more variables: IE &lt;dbl&gt;, `` &lt;dbl&gt; 3.6 GSEA analysis based on differential express gene analysis results Select the gene set list in IOBR’s signature collection. head(deg) ## # A tibble: 6 × 11 ## symbol log2FoldChange AveExpr t pvalue padj B sigORnot label ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; ## 1 TMEM100 0.774 1.84 13.9 2.47e-31 5.37e-27 60.4 Up_regulat… Both ## 2 ABCA8 0.933 1.90 12.9 3.11e-28 3.38e-24 53.4 Up_regulat… Both ## 3 HHIP 0.613 1.73 12.1 7.62e-26 4.46e-22 48.0 Up_regulat… Both ## 4 LMNB2 -0.287 2.25 -12.1 9.28e-26 4.46e-22 47.8 NOT Sign… ## 5 MCM6 -0.211 3.02 -12.1 1.02e-25 4.46e-22 47.7 NOT Sign… ## 6 ADH1B 0.907 1.86 12.0 2.27e-25 7.04e-22 47.0 Up_regulat… Both ## # ℹ 2 more variables: IE &lt;dbl&gt;, `` &lt;dbl&gt; sig_list &lt;- signature_collection[c(&quot;TMEscoreB_CIR&quot;, &quot;TMEscoreA_CIR&quot;, &quot;DNA_replication&quot;, &quot;Base_excision_repair&quot;, &quot;Pan_F_TBRs&quot;, &quot;TGFb.myCAF&quot;, &quot;Ferroptosis&quot;, &quot;TLS_Nature&quot;, &quot;Glycolysis&quot;)] sig_list ## $TMEscoreB_CIR ## [1] &quot;DCN&quot; &quot;SEPP1&quot; &quot;ACTA2&quot; &quot;SPARCL1&quot; &quot;BEX3&quot; ## [6] &quot;MYLK&quot; &quot;AKR1C1&quot; &quot;TIMP2&quot; &quot;MXRA7&quot; &quot;C11orf96&quot; ## [11] &quot;CAV1&quot; &quot;PDGFRA&quot; &quot;FHL1&quot; &quot;MGP&quot; &quot;EID1&quot; ## [16] &quot;LOC101930400&quot; &quot;DST&quot; &quot;GREM1&quot; &quot;FERMT2&quot; &quot;TNC&quot; ## [21] &quot;CYBRD1&quot; &quot;LTBP1&quot; &quot;ACTG2&quot; &quot;TMEM47&quot; &quot;SERPINE2&quot; ## [26] &quot;ANTXR2&quot; &quot;GNG11&quot; &quot;TAGLN&quot; &quot;GSTA4&quot; &quot;PKIG&quot; ## [31] &quot;MAOA&quot; &quot;PTRF&quot; &quot;FAM3B&quot; &quot;PBX1&quot; &quot;WLS&quot; ## [36] &quot;SELM&quot; &quot;SVIL&quot; &quot;MYH11&quot; &quot;AGT&quot; &quot;SPON1&quot; ## [41] &quot;TGFB1I1&quot; &quot;PDLIM3&quot; &quot;PDK4&quot; &quot;SYNPO2&quot; &quot;MSRB3&quot; ## [46] &quot;PROS1&quot; &quot;EDNRA&quot; &quot;AKAP12&quot; &quot;PSD3&quot; &quot;TNS1&quot; ## [51] &quot;JAM3&quot; &quot;PDZRN3&quot; &quot;DDR2&quot; &quot;HMGCS2&quot; &quot;SGCE&quot; ## [56] &quot;MRVI1&quot; &quot;WFDC1&quot; &quot;FBLN1&quot; &quot;FMO5&quot; &quot;MAOB&quot; ## [61] &quot;AMOTL1&quot; &quot;AKT3&quot; &quot;CNRIP1&quot; &quot;CPE&quot; &quot;MAP1B&quot; ## [66] &quot;RBP1&quot; &quot;GNAI1&quot; &quot;FOXF2&quot; &quot;SORBS2&quot; &quot;ZCCHC24&quot; ## [71] &quot;ZNF704&quot; &quot;ARMCX1&quot; &quot;DIXDC1&quot; &quot;SSTR1&quot; &quot;THRB&quot; ## [76] &quot;C3orf70&quot; &quot;PKIB&quot; &quot;CNN1&quot; &quot;SYTL5&quot; &quot;DACT1&quot; ## [81] &quot;SYNPO&quot; &quot;GAS1&quot; &quot;DPYSL3&quot; &quot;CCDC80&quot; &quot;TSPYL5&quot; ## [86] &quot;DCHS1&quot; &quot;SOBP&quot; &quot;AOC3&quot; &quot;NDN&quot; &quot;FGF7P3&quot; ## [91] &quot;SMAD9&quot; &quot;MCC&quot; &quot;CLMP&quot; &quot;MYL9&quot; &quot;RBP4&quot; ## [96] &quot;PLN&quot; &quot;SPOCK1&quot; &quot;COL14A1&quot; &quot;CRYAB&quot; &quot;SRPX&quot; ## [101] &quot;EML1&quot; &quot;RERG&quot; &quot;PPP1R3C&quot; &quot;LOC100506718&quot; &quot;CH25H&quot; ## [106] &quot;HSPB8&quot; &quot;PID1&quot; &quot;TTC28&quot; &quot;STON1&quot; &quot;ABCG2&quot; ## [111] &quot;ZSCAN18&quot; &quot;SCIN&quot; &quot;C14orf132&quot; &quot;TMEM55A&quot; &quot;WASF3&quot; ## [116] &quot;PAPLN&quot; &quot;COLEC12&quot; &quot;ACKR1&quot; &quot;TMEM150C&quot; &quot;RAI2&quot; ## [121] &quot;TSPAN7&quot; &quot;MRGPRF&quot; &quot;ABCA8&quot; &quot;CHIC1&quot; &quot;NBEA&quot; ## [126] &quot;FAM13C&quot; &quot;SETBP1&quot; &quot;LDOC1&quot; &quot;TMEM100&quot; &quot;LOC101930349&quot; ## [131] &quot;PRICKLE2&quot; &quot;TSPAN18&quot; &quot;FABP4&quot; &quot;ARHGEF26&quot; &quot;ERICH5&quot; ## [136] &quot;MYOCD&quot; &quot;BEX2&quot; &quot;PPP1R14A&quot; &quot;FGF13&quot; &quot;RUNX1T1&quot; ## [141] &quot;MAGI2-AS3&quot; &quot;LINC01279&quot; &quot;REEP1&quot; &quot;PLAC9&quot; &quot;MYEF2&quot; ## [146] &quot;PRKD1&quot; &quot;RGN&quot; &quot;CLDN11&quot; &quot;ANK2&quot; &quot;ESRRG&quot; ## [151] &quot;SYNC&quot; &quot;ZNF667-AS1&quot; &quot;FGF7&quot; &quot;SFRP1&quot; &quot;HMCN1&quot; ## [156] &quot;TCEAL7&quot; &quot;OGN&quot; &quot;MAGI2&quot; &quot;MIR100HG&quot; &quot;FILIP1&quot; ## [161] &quot;LOC100507334&quot; &quot;ANKRD6&quot; &quot;PLEKHH2&quot; &quot;ZNF542P&quot; &quot;ARMCX4&quot; ## [166] &quot;NOV&quot; &quot;DCLK1&quot; &quot;ARHGAP28&quot; &quot;C2orf40&quot; &quot;TRHDE&quot; ## [171] &quot;EPHA7&quot; &quot;SCRG1&quot; &quot;ZNF677&quot; &quot;ZFPM2&quot; &quot;PEG3&quot; ## [176] &quot;SERP2&quot; &quot;ZNF415&quot; &quot;MAMDC2&quot; &quot;RBM24&quot; &quot;MEOX2&quot; ## ## $TMEscoreA_CIR ## [1] &quot;HLA-DPB1&quot; &quot;UBD&quot; &quot;LOC100509457&quot; &quot;WARS&quot; ## [5] &quot;TAP1&quot; &quot;HLA-DMA&quot; &quot;TRIM22&quot; &quot;PSAT1&quot; ## [9] &quot;CXCL10&quot; &quot;SOCS3&quot; &quot;CXCL9&quot; &quot;PBK&quot; ## [13] &quot;CCL4&quot; &quot;CCL5&quot; &quot;BCL2A1&quot; &quot;TRBC1&quot; ## [17] &quot;IDO1&quot; &quot;NFE2L3&quot; &quot;CCL3L3&quot; &quot;DTL&quot; ## [21] &quot;MMP9&quot; &quot;SLC2A3&quot; &quot;ZNF367&quot; &quot;RCC1&quot; ## [25] &quot;STIL&quot; &quot;TRAC&quot; &quot;HELLS&quot; &quot;GZMB&quot; ## [29] &quot;RTEL1-TNFRSF6B&quot; &quot;CXCL11&quot; &quot;GBP5&quot; &quot;CD2&quot; ## [33] &quot;CDCA2&quot; &quot;CDT1&quot; &quot;TNFAIP2&quot; &quot;TYMP&quot; ## [37] &quot;MICB&quot; &quot;SLC2A14&quot; &quot;GZMK&quot; &quot;CD8A&quot; ## [41] &quot;CENPH&quot; &quot;MND1&quot; &quot;BATF2&quot; &quot;BRIP1&quot; ## [45] &quot;E2F7&quot; &quot;KIF18A&quot; &quot;AIM2&quot; &quot;ETV7&quot; ## [49] &quot;ITK&quot; &quot;GNLY&quot; &quot;GPR171&quot; &quot;WDHD1&quot; ## [53] &quot;GBP4&quot; &quot;MB21D1&quot; &quot;NLRP3&quot; &quot;MCEMP1&quot; ## [57] &quot;POLR3G&quot; &quot;NLRC3&quot; &quot;KLRC2&quot; &quot;CLEC5A&quot; ## [61] &quot;ARHGAP11A&quot; &quot;GPR84&quot; &quot;IFNG&quot; &quot;ZBED2&quot; ## ## $DNA_replication ## [1] &quot;RNASEH2A&quot; &quot;POLD3&quot; &quot;DNA2&quot; &quot;FEN1&quot; &quot;POLA2&quot; &quot;RNASEH1&quot; ## [7] &quot;RPA4&quot; &quot;LIG1&quot; &quot;MCM2&quot; &quot;MCM3&quot; &quot;MCM4&quot; &quot;MCM5&quot; ## [13] &quot;MCM6&quot; &quot;MCM7&quot; &quot;PCNA&quot; &quot;POLE3&quot; &quot;POLA1&quot; &quot;POLD1&quot; ## [19] &quot;POLD2&quot; &quot;POLE&quot; &quot;POLE2&quot; &quot;PRIM1&quot; &quot;PRIM2&quot; &quot;POLE4&quot; ## [25] &quot;POLD4&quot; &quot;RFC1&quot; &quot;RFC2&quot; &quot;RFC3&quot; &quot;RFC4&quot; &quot;RFC5&quot; ## [31] &quot;RPA1&quot; &quot;RPA2&quot; &quot;RPA3&quot; &quot;SSBP1&quot; &quot;RNASEH2B&quot; &quot;RNASEH2C&quot; ## ## $Base_excision_repair ## [1] &quot;PARP2&quot; &quot;PARP3&quot; &quot;POLD3&quot; &quot;PARP1&quot; &quot;PARP4&quot; &quot;FEN1&quot; &quot;SMUG1&quot; &quot;NEIL2&quot; &quot;APEX2&quot; ## [10] &quot;POLL&quot; &quot;HMGB1&quot; &quot;APEX1&quot; &quot;LIG1&quot; &quot;LIG3&quot; &quot;MPG&quot; &quot;MUTYH&quot; &quot;NTHL1&quot; &quot;OGG1&quot; ## [19] &quot;PCNA&quot; &quot;POLE3&quot; &quot;POLB&quot; &quot;POLD1&quot; &quot;POLD2&quot; &quot;POLE&quot; &quot;POLE2&quot; &quot;NEIL3&quot; &quot;POLE4&quot; ## [28] &quot;POLD4&quot; &quot;UNG&quot; &quot;XRCC1&quot; &quot;NEIL1&quot; &quot;MBD4&quot; ## ## $Pan_F_TBRs ## [1] &quot;ACTA2&quot; &quot;ACTG2&quot; &quot;ADAM12&quot; &quot;ADAM19&quot; &quot;CNN1&quot; &quot;COL4A1&quot; ## [7] &quot;CTGF&quot; &quot;CTPS1&quot; &quot;FAM101B&quot; &quot;FSTL3&quot; &quot;HSPB1&quot; &quot;IGFBP3&quot; ## [13] &quot;PXDC1&quot; &quot;SEMA7A&quot; &quot;SH3PXD2A&quot; &quot;TAGLN&quot; &quot;TGFBI&quot; &quot;TNS1&quot; ## [19] &quot;TPM1&quot; ## ## $TGFb.myCAF ## [1] &quot;CST1&quot; &quot;LAMP5&quot; &quot;LOXL1&quot; &quot;EDNRA&quot; &quot;TGFB1&quot; &quot;TGFB3&quot; &quot;TNN&quot; ## [8] &quot;CST2&quot; &quot;HES4&quot; &quot;COL10A1&quot; &quot;ELN&quot; &quot;THBS4&quot; &quot;NKD2&quot; &quot;OLFM2&quot; ## [15] &quot;COL6A3&quot; &quot;LRRC17&quot; &quot;COL3A1&quot; &quot;THY1&quot; &quot;HTRA3&quot; &quot;TMEM204&quot; &quot;11-Sep&quot; ## [22] &quot;COMP&quot; &quot;TNFAIP6&quot; &quot;ID4&quot; &quot;GGT5&quot; &quot;INAFM1&quot; &quot;CILP&quot; &quot;OLFML2B&quot; ## ## $Ferroptosis ## [1] &quot;ACSL4&quot; &quot;AKR1C1-3&quot; &quot;ALOXs&quot; &quot;ATP5G3&quot; &quot;CARS&quot; ## [6] &quot;CBS&quot; &quot;CD44v&quot; &quot;CHAC1&quot; &quot;CISD1&quot; &quot;CS&quot; ## [11] &quot;DPP4&quot; &quot;FANCD2&quot; &quot;GCLC/GCLM&quot; &quot;GLS2&quot; &quot;GPX4&quot; ## [16] &quot;GSS&quot; &quot;HMGCR&quot; &quot;HSPB1/5&quot; &quot;KOD&quot; &quot;LPCAT3&quot; ## [21] &quot;MT1G&quot; &quot;NCOA4&quot; &quot;NFE2L2&quot; &quot;PTGS2&quot; &quot;RPL8&quot; ## [26] &quot;SAT1&quot; &quot;SLC7A11&quot; &quot;SQS&quot; &quot;TFRC&quot; &quot;TP53&quot; ## [31] &quot;TTC35/EMC2&quot; &quot;MESH1&quot; ## ## $TLS_Nature ## [1] &quot;CD79B&quot; &quot;CD1D&quot; &quot;CCR6&quot; &quot;LAT&quot; &quot;SKAP1&quot; &quot;CETP&quot; &quot;EIF1AY&quot; &quot;RBP5&quot; ## [9] &quot;PTGDS&quot; ## ## $Glycolysis ## [1] &quot;ACSS1&quot; &quot;ACSS2&quot; &quot;ADH1A&quot; &quot;ADH1B&quot; &quot;ADH1C&quot; &quot;ADH4&quot; &quot;ADH5&quot; ## [8] &quot;ADH6&quot; &quot;ADH7&quot; &quot;ADPGK&quot; &quot;AKR1A1&quot; &quot;ALDH1A3&quot; &quot;ALDH1B1&quot; &quot;ALDH2&quot; ## [15] &quot;ALDH3A1&quot; &quot;ALDH3A2&quot; &quot;ALDH3B1&quot; &quot;ALDH3B2&quot; &quot;ALDH7A1&quot; &quot;ALDH9A1&quot; &quot;ALDOA&quot; ## [22] &quot;ALDOB&quot; &quot;ALDOC&quot; &quot;BPGM&quot; &quot;DLAT&quot; &quot;DLD&quot; &quot;ENO1&quot; &quot;ENO2&quot; ## [29] &quot;ENO3&quot; &quot;FBP1&quot; &quot;FBP2&quot; &quot;G6PC&quot; &quot;G6PC2&quot; &quot;GALM&quot; &quot;GAPDH&quot; ## [36] &quot;GAPDHS&quot; &quot;GCK&quot; &quot;GPI&quot; &quot;HK1&quot; &quot;HK2&quot; &quot;HK3&quot; &quot;HKDC1&quot; ## [43] &quot;LDHA&quot; &quot;LDHAL6A&quot; &quot;LDHAL6B&quot; &quot;LDHB&quot; &quot;LDHC&quot; &quot;PANK1&quot; &quot;PCK1&quot; ## [50] &quot;PCK2&quot; &quot;PDHA1&quot; &quot;PDHA2&quot; &quot;PDHB&quot; &quot;PFKFB1&quot; &quot;PFKFB2&quot; &quot;PFKFB3&quot; ## [57] &quot;PFKFB4&quot; &quot;PFKL&quot; &quot;PFKM&quot; &quot;PFKP&quot; &quot;PGAM1&quot; &quot;PGAM2&quot; &quot;PGAM4&quot; ## [64] &quot;PGK1&quot; &quot;PGK2&quot; &quot;PGM1&quot; &quot;PGM2&quot; &quot;PKLR&quot; &quot;PKM&quot; &quot;SLC2A2&quot; ## [71] &quot;TPI1&quot; gsea&lt;- sig_gsea(deg, genesets = sig_list, path = &quot;GSEA&quot;, gene_symbol = &quot;symbol&quot;, logfc = &quot;log2FoldChange&quot;, org = &quot;hsa&quot;, show_plot = FALSE, msigdb = TRUE, category = &quot;H&quot;, subcategory = NULL, palette_bar = &quot;set2&quot;) Figure 3.1: GSEA of TME gent sets Hallmark gene signatures gsea&lt;- sig_gsea(deg, genesets = NULL, path = &quot;GSEA&quot;, gene_symbol = &quot;symbol&quot;, logfc = &quot;log2FoldChange&quot;, org = &quot;hsa&quot;, show_plot = FALSE, msigdb = TRUE, category = &quot;H&quot;, subcategory = NULL, palette_bar = &quot;aaas&quot;, show_bar = 5, show_gsea = 6) Figure 3.2: GSEA of Hallmark gent sets 3.7 DEG analysis: method2 Identifing TME subtype-related differential genes using find_markers_in_bulk library(Seurat) res &lt;- find_markers_in_bulk(pdata = tme, eset = eset, group = &quot;TMEcluster&quot;, nfeatures = 2000, top_n = 20, thresh.use = 0.15, only.pos = TRUE, min.pct = 0.10) ## ## IA IE IS ## 107 96 97 ## # A tibble: 56 × 7 ## # Groups: cluster [3] ## p_val avg_log2FC pct.1 pct.2 p_val_adj cluster gene ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt; ## 1 3.29e-20 0.218 1 1 7.15e-16 IA IFNG ## 2 1.81e-18 0.172 1 1 3.93e-14 IA CXCL10 ## 3 1.01e-16 0.183 1 1 2.20e-12 IA GZMB ## 4 2.82e-16 0.251 1 1 6.12e-12 IA CXCL11 ## 5 9.68e-16 0.170 1 1 2.10e-11 IA CXCL9 ## 6 3.11e-15 0.221 1 1 6.77e-11 IA IDO1 ## 7 9.90e-15 0.156 1 1 2.15e-10 IA POLR3G ## 8 3.02e-14 0.184 1 1 6.57e-10 IA GBP4 ## 9 9.23e-14 0.152 1 1 2.01e- 9 IA ZBED2 ## 10 9.79e-12 0.155 1 1 2.13e- 7 IA GNLY ## # ℹ 46 more rows top15 &lt;- res$top_markers %&gt;% dplyr:: group_by(cluster) %&gt;% dplyr::top_n(15, avg_log2FC) top15$gene ## [1] &quot;IFNG&quot; &quot;CXCL10&quot; &quot;GZMB&quot; &quot;CXCL11&quot; ## [5] &quot;CXCL9&quot; &quot;IDO1&quot; &quot;POLR3G&quot; &quot;GBP4&quot; ## [9] &quot;GNLY&quot; &quot;PLEKHS1&quot; &quot;KLRC2&quot; &quot;VSNL1&quot; ## [13] &quot;AIM2&quot; &quot;SLCO1B3&quot; &quot;COL11A1&quot; &quot;TMEM100&quot; ## [17] &quot;ADH1B&quot; &quot;ABCA8&quot; &quot;MAMDC2&quot; &quot;C1QTNF7&quot; ## [21] &quot;SCN7A&quot; &quot;C7&quot; &quot;C2orf40&quot; &quot;LIPF&quot; ## [25] &quot;PGA4&quot; &quot;SCRG1&quot; &quot;OGN&quot; &quot;GKN1&quot; ## [29] &quot;GKN2&quot; &quot;GIF&quot; &quot;IL1A&quot; &quot;EREG&quot; ## [33] &quot;PPBP&quot; &quot;IL11&quot; &quot;CXCL6&quot; &quot;PI15&quot; ## [37] &quot;PROK2&quot; &quot;HCAR3&quot; &quot;CLEC5A&quot; &quot;MAGEA10-MAGEA5&quot; ## [41] &quot;MAGEA4&quot; &quot;MAGEA12&quot; &quot;MAGEA6&quot; &quot;MAGEA2B&quot; ## [45] &quot;REG1B&quot; Heatmap visualisation using Seurat’s DoHeatmap #定义分型对应的颜色 cols &lt;- c(&#39;#2692a4&#39;,&#39;#fc0d3a&#39;,&#39;#ffbe0b&#39;) p1 &lt;- DoHeatmap(res$sce, top15$gene, group.colors = cols )+ scale_fill_gradientn(colours = rev(colorRampPalette(RColorBrewer::brewer.pal(11,&quot;RdBu&quot;))(256))) Extracting variables from the expression matrix to merge with TME subtype input &lt;- combine_pd_eset(eset = eset, pdata = tme, feas = top15$gene, scale = T) p2 &lt;- sig_box(input, variable = &quot;TMEcluster&quot;, signature = &quot;IFNG&quot;, jitter = TRUE, cols = cols, show_pvalue = TRUE, size_of_pvalue = 4) ## # A tibble: 3 × 8 ## .y. group1 group2 p p.adj p.format p.signif method ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 signature IA IE 4.09e-17 1.20e-16 &lt; 2e-16 **** Wilcoxon ## 2 signature IA IS 1.44e-13 2.90e-13 1.4e-13 **** Wilcoxon ## 3 signature IE IS 8.35e- 2 8.4 e- 2 0.084 ns Wilcoxon p3 &lt;- sig_box(input, variable = &quot;TMEcluster&quot;, signature = &quot;IL1A&quot;, jitter = TRUE, cols = cols, show_pvalue = TRUE, size_of_pvalue = 4) ## # A tibble: 3 × 8 ## .y. group1 group2 p p.adj p.format p.signif method ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 signature IA IE 1.46e-10 2.90e-10 1.5e-10 **** Wilcoxon ## 2 signature IA IS 8.22e- 7 8.2 e- 7 8.2e-07 **** Wilcoxon ## 3 signature IE IS 4.90e-20 1.5 e-19 &lt; 2e-16 **** Wilcoxon 合并以上获得的结果图 if (!requireNamespace(&quot;patchwork&quot;, quietly = TRUE)) install.packages(&quot;patchwork&quot;) library(patchwork) p &lt;- (p1|p2/p3) + plot_layout(widths = c(2.3,1)) p + plot_annotation(tag_levels = &#39;A&#39;) 3.8 Identifying signatures associated with TME clusters Calculate TME associated signatures-(through PCA method). sig_tme&lt;-calculate_sig_score(pdata = NULL, eset = eset, signature = signature_collection, method = &quot;pca&quot;, mini_gene_count = 2) sig_tme &lt;- t(column_to_rownames(sig_tme, var = &quot;ID&quot;)) sig_tme[1:5, 1:3] ## GSM1523727 GSM1523728 GSM1523729 ## CD_8_T_effector -2.5513794 0.7789141 -2.1770675 ## DDR -0.8747614 0.7425162 -1.3272054 ## APM 1.1098368 2.1988688 -0.9516419 ## Immune_Checkpoint -2.3701787 0.9455120 -1.4844104 ## CellCycle_Reg 0.1063358 0.7583302 -0.3649795 寻找与TMEcluster相关的特征变量 res &lt;- find_markers_in_bulk(pdata = tme, eset = sig_tme, group = &quot;TMEcluster&quot;, nfeatures = 1000, top_n = 20, min.pct = 0.10) ## ## IA IE IS ## 107 96 97 ## # A tibble: 58 × 7 ## # Groups: cluster [3] ## p_val avg_log2FC pct.1 pct.2 p_val_adj cluster gene ## &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt; ## 1 6.21e-19 4.07 0.701 0.316 1.59e-16 IA IFNG-signature-Ayers-et-al ## 2 1.82e-17 5.18 0.813 0.399 4.66e-15 IA Th2-cells-Bindea-et-al ## 3 2.60e-16 4.65 0.813 0.383 6.65e-14 IA Folate-One-Carbon-Metaboli… ## 4 1.52e-15 5.12 0.804 0.352 3.89e-13 IA Homologous-recombination ## 5 4.95e-15 4.84 0.673 0.275 1.27e-12 IA CD-8-T-effector ## 6 7.70e-15 3.16 0.71 0.332 1.97e-12 IA Th1-cells-Bindea-et-al ## 7 9.52e-14 3.16 0.822 0.399 2.44e-11 IA Purine-Biosynthesis ## 8 1.42e-13 2.83 0.664 0.352 3.63e-11 IA ADP-Ribosylation ## 9 5.96e-13 2.96 0.785 0.42 1.53e-10 IA TIP-Release-of-cancer-cell… ## 10 3.00e-12 2.71 0.776 0.409 7.68e-10 IA Glycine--Serine-and-Threon… ## # ℹ 48 more rows top15 &lt;- res$top_markers %&gt;% dplyr:: group_by(cluster) %&gt;% dplyr::top_n(15, avg_log2FC) p1 &lt;- DoHeatmap(res$sce, top15$gene, group.colors = cols)+ scale_fill_gradientn(colours = rev(colorRampPalette(RColorBrewer::brewer.pal(11,&quot;RdBu&quot;))(256))) 可视化结果：选择特征变量 top15$gene &lt;- gsub(top15$gene, pattern = &quot;\\\\-&quot;, replacement = &quot;\\\\_&quot;) input &lt;- combine_pd_eset(eset = sig_tme, pdata = tme, feas = top15$gene, scale = T) p2 &lt;- sig_box(input, variable = &quot;TMEcluster&quot;, signature = &quot;IFNG_signature_Ayers_et_al&quot;, jitter = TRUE, cols = cols, show_pvalue = TRUE, size_of_pvalue = 4, size_of_font = 6) ## # A tibble: 3 × 8 ## .y. group1 group2 p p.adj p.format p.signif method ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 signature IA IE 2.98e-13 6 e-13 3.0e-13 **** Wilcoxon ## 2 signature IA IS 1.85e-15 5.6e-15 1.9e-15 **** Wilcoxon ## 3 signature IE IS 2.68e- 1 2.7e- 1 0.27 ns Wilcoxon p3 &lt;- sig_box(input, variable = &quot;TMEcluster&quot;, signature = &quot;Neutrophils_Bindea_et_al&quot;, jitter = TRUE, cols = cols, show_pvalue = TRUE, size_of_pvalue = 4, size_of_font = 6) ## # A tibble: 3 × 8 ## .y. group1 group2 p p.adj p.format p.signif method ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 signature IA IE 0.00639 0.013 0.0064 ** Wilcoxon ## 2 signature IA IS 0.0584 0.058 0.0584 ns Wilcoxon ## 3 signature IE IS 0.0000929 0.00028 9.3e-05 **** Wilcoxon p &lt;- (p1|p2/p3) + plot_layout(widths = c(2.3,1)) p + plot_annotation(tag_levels = &#39;A&#39;) library(survminer) data(pdata_acrg, package = &quot;IOBR&quot;) input &lt;- merge(pdata_acrg, input, by = &quot;ID&quot;) p1&lt;-surv_group(input_pdata = input, target_group = &quot;TMEcluster&quot;, ID = &quot;ID&quot;, reference_group = &quot;High&quot;, project = &quot;ACRG&quot;, cols = cols, time = &quot;OS_time&quot;, status = &quot;OS_status&quot;, time_type = &quot;month&quot;, save_path = &quot;result&quot;) ## &gt;&gt;&gt; Dataset&#39;s survival follow up time is range between 1 to 105.7 months ## IA IE IS ## 107 96 97 ## 1079697 ## Maximum of follow up time is 105.7 months; and will be divided into 6 sections; p1 p1&lt;- percent_bar_plot(input, x = &quot;TMEcluster&quot; , y = &quot;Subtype&quot;, palette = &quot;jama&quot;) ## # A tibble: 12 × 5 ## # Groups: TMEcluster [3] ## TMEcluster Subtype Freq Prop count ## &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 IA EMT 7 0.07 107 ## 2 IA MSI 49 0.46 107 ## 3 IA MSS/TP53- 27 0.25 107 ## 4 IA MSS/TP53+ 24 0.22 107 ## 5 IE EMT 24 0.25 96 ## 6 IE MSI 3 0.03 96 ## 7 IE MSS/TP53- 40 0.42 96 ## 8 IE MSS/TP53+ 29 0.3 96 ## 9 IS EMT 15 0.15 97 ## 10 IS MSI 16 0.16 97 ## 11 IS MSS/TP53- 40 0.41 97 ## 12 IS MSS/TP53+ 26 0.27 97 ## [1] &quot;&#39;#374E55FF&#39;, &#39;#DF8F44FF&#39;, &#39;#00A1D5FF&#39;, &#39;#B24745FF&#39;, &#39;#79AF97FF&#39;, &#39;#6A6599FF&#39;, &#39;#80796BFF&#39;&quot; p2&lt;- percent_bar_plot(input, x = &quot;TMEcluster&quot; , y = &quot;Lauren&quot;, palette = &quot;jama&quot;) ## # A tibble: 9 × 5 ## # Groups: TMEcluster [3] ## TMEcluster Lauren Freq Prop count ## &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 IA Diffuse 34 0.32 107 ## 2 IA Intestinal 60 0.56 107 ## 3 IA Mixed 13 0.12 107 ## 4 IE Diffuse 60 0.62 96 ## 5 IE Intestinal 32 0.33 96 ## 6 IE Mixed 4 0.04 96 ## 7 IS Diffuse 41 0.42 97 ## 8 IS Intestinal 54 0.56 97 ## 9 IS Mixed 2 0.02 97 ## [1] &quot;&#39;#374E55FF&#39;, &#39;#DF8F44FF&#39;, &#39;#00A1D5FF&#39;, &#39;#B24745FF&#39;, &#39;#79AF97FF&#39;, &#39;#6A6599FF&#39;, &#39;#80796BFF&#39;&quot; p3&lt;- percent_bar_plot(input, x = &quot;TMEcluster&quot; , y = &quot;TMEscore_binary&quot;, palette = &quot;jama&quot;) ## # A tibble: 7 × 5 ## # Groups: TMEcluster [3] ## TMEcluster TMEscore_binary Freq Prop count ## &lt;chr&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 IA High 60 0.56 107 ## 2 IA Low 47 0.44 107 ## 3 IE High 5 0.05 96 ## 4 IE Low 91 0.95 96 ## 5 IS High 6 0.06 97 ## 6 IS Low 90 0.93 97 ## 7 IS &lt;NA&gt; 1 0.01 97 ## [1] &quot;&#39;#374E55FF&#39;, &#39;#DF8F44FF&#39;, &#39;#00A1D5FF&#39;, &#39;#B24745FF&#39;, &#39;#79AF97FF&#39;, &#39;#6A6599FF&#39;, &#39;#80796BFF&#39;&quot; p1|p2|p3 "],["signature-and-relevant-phenotypes.html", "Chapter 4 Signature and relevant phenotypes 4.1 Loading packages 4.2 Downloading data for example 4.3 Signature score estimation 4.4 Identifying features associated with survival 4.5 Visulization using heatmap 4.6 Focus on target signatures 4.7 Survival analysis 4.8 Batch correlation analysis 4.9 Visulization of correlations", " Chapter 4 Signature and relevant phenotypes 4.1 Loading packages Load the IOBR package in your R session after the installation is complete: library(IOBR) library(survminer) library(tidyverse) 4.2 Downloading data for example Obtaining data set from GEO Gastric cancer: GSE62254 using GEOquery R package. if (!requireNamespace(&quot;GEOquery&quot;, quietly = TRUE)) BiocManager::install(&quot;GEOquery&quot;) library(&quot;GEOquery&quot;) # NOTE: This process may take a few minutes which depends on the internet connection speed. Please wait for its completion. eset_geo &lt;- getGEO(GEO = &quot;GSE62254&quot;, getGPL = F, destdir = &quot;./&quot;) eset &lt;-eset_geo[[1]] eset &lt;-exprs(eset) eset[1:5,1:5] ## GSM1523727 GSM1523728 GSM1523729 GSM1523744 GSM1523745 ## 1007_s_at 3.2176645 3.0624323 3.0279131 2.921683 2.8456013 ## 1053_at 2.4050109 2.4394879 2.2442708 2.345916 2.4328582 ## 117_at 1.4933412 1.8067380 1.5959665 1.839822 1.8326058 ## 121_at 2.1965561 2.2812181 2.1865556 2.258599 2.1874363 ## 1255_g_at 0.8698382 0.9502466 0.8125414 1.012860 0.9441993 Annotation of genes in the expression matrix and removal of duplicate genes. # Load the annotation file `anno_hug133plus2` in IOBR. head(anno_hug133plus2) ## # A tibble: 6 × 2 ## probe_id symbol ## &lt;fct&gt; &lt;fct&gt; ## 1 1007_s_at MIR4640 ## 2 1053_at RFC2 ## 3 117_at HSPA6 ## 4 121_at PAX8 ## 5 1255_g_at GUCA1A ## 6 1294_at MIR5193 # Conduct gene annotation using `anno_hug133plus2` file; If identical gene symbols exists, these genes would be ordered by the mean expression levels. The gene symbol with highest mean expression level is selected and remove others. eset&lt;-anno_eset(eset = eset, annotation = anno_hug133plus2, symbol = &quot;symbol&quot;, probe = &quot;probe_id&quot;, method = &quot;mean&quot;) eset[1:5, 1:3] ## GSM1523727 GSM1523728 GSM1523729 ## SH3KBP1 4.327974 4.316195 4.351425 ## RPL41 4.246149 4.246808 4.257940 ## EEF1A1 4.293762 4.291038 4.262199 ## COX2 4.250288 4.283714 4.270508 ## LOC101928826 4.219303 4.219670 4.213252 4.3 Signature score estimation 4.3.1 Signature collection of IOBR # Return available parameter options of signature estimation. signature_score_calculation_methods ## PCA ssGSEA z-score Integration ## &quot;pca&quot; &quot;ssgsea&quot; &quot;zscore&quot; &quot;integration&quot; #TME associated signatures names(signature_tme)[1:20] ## [1] &quot;CD_8_T_effector&quot; &quot;DDR&quot; ## [3] &quot;APM&quot; &quot;Immune_Checkpoint&quot; ## [5] &quot;CellCycle_Reg&quot; &quot;Pan_F_TBRs&quot; ## [7] &quot;Histones&quot; &quot;EMT1&quot; ## [9] &quot;EMT2&quot; &quot;EMT3&quot; ## [11] &quot;WNT_target&quot; &quot;FGFR3_related&quot; ## [13] &quot;Cell_cycle&quot; &quot;Mismatch_Repair&quot; ## [15] &quot;Homologous_recombination&quot; &quot;Nucleotide_excision_repair&quot; ## [17] &quot;DNA_replication&quot; &quot;Base_excision_repair&quot; ## [19] &quot;TMEscoreA_CIR&quot; &quot;TMEscoreB_CIR&quot; #Metabolism related signatures names(signature_metabolism)[1:20] ## [1] &quot;Cardiolipin_Metabolism&quot; ## [2] &quot;Cardiolipin_Biosynthesis&quot; ## [3] &quot;Cholesterol_Biosynthesis&quot; ## [4] &quot;Citric_Acid_Cycle&quot; ## [5] &quot;Cyclooxygenase_Arachidonic_Acid_Metabolism&quot; ## [6] &quot;Prostaglandin_Biosynthesis&quot; ## [7] &quot;Purine_Biosynthesis&quot; ## [8] &quot;Pyrimidine_Biosynthesis&quot; ## [9] &quot;Dopamine_Biosynthesis&quot; ## [10] &quot;Epinephrine_Biosynthesis&quot; ## [11] &quot;Norepinephrine_Biosynthesis&quot; ## [12] &quot;Fatty_Acid_Degradation&quot; ## [13] &quot;Fatty_Acid_Elongation&quot; ## [14] &quot;Fatty_Acid_Biosynthesis&quot; ## [15] &quot;Folate_One_Carbon_Metabolism&quot; ## [16] &quot;Folate_biosynthesis&quot; ## [17] &quot;Gluconeogenesis&quot; ## [18] &quot;Glycolysis&quot; ## [19] &quot;Glycogen_Biosynthesis&quot; ## [20] &quot;Glycogen_Degradation&quot; #Signatures associated with biomedical basic research: such as m6A and exosomes names(signature_tumor) ## [1] &quot;Nature_metabolism_Hypoxia&quot; ## [2] &quot;Winter_hypoxia_signature&quot; ## [3] &quot;Hu_hypoxia_signature&quot; ## [4] &quot;Molecular_Cancer_m6A&quot; ## [5] &quot;MT_exosome&quot; ## [6] &quot;SR_exosome&quot; ## [7] &quot;Positive_regulation_of_exosomal_secretion&quot; ## [8] &quot;Negative_regulation_of_exosomal_secretion&quot; ## [9] &quot;Exosomal_secretion&quot; ## [10] &quot;Exosome_assembly&quot; ## [11] &quot;Extracellular_vesicle_biogenesis&quot; ## [12] &quot;MC_Review_Exosome1&quot; ## [13] &quot;MC_Review_Exosome2&quot; ## [14] &quot;CMLS_Review_Exosome&quot; ## [15] &quot;Ferroptosis&quot; ## [16] &quot;EV_Cell_2020&quot; #signature collection including all aforementioned signatures names(signature_collection)[1:20] ## [1] &quot;CD_8_T_effector&quot; &quot;DDR&quot; ## [3] &quot;APM&quot; &quot;Immune_Checkpoint&quot; ## [5] &quot;CellCycle_Reg&quot; &quot;Pan_F_TBRs&quot; ## [7] &quot;Histones&quot; &quot;EMT1&quot; ## [9] &quot;EMT2&quot; &quot;EMT3&quot; ## [11] &quot;WNT_target&quot; &quot;FGFR3_related&quot; ## [13] &quot;Cell_cycle&quot; &quot;Mismatch_Repair&quot; ## [15] &quot;Homologous_recombination&quot; &quot;Nucleotide_excision_repair&quot; ## [17] &quot;DNA_replication&quot; &quot;Base_excision_repair&quot; ## [19] &quot;TMEscoreA_CIR&quot; &quot;TMEscoreB_CIR&quot; #citation of signatures signature_collection_citation[1:20, ] ## # A tibble: 20 × 6 ## Signatures `Published year` Journal Title PMID DOI ## &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 CD_8_T_effector 2018 Nature TGFβ… 2944… 10.1… ## 2 DDR 2018 Nature TGFβ… 2944… 10.1… ## 3 APM 2018 Nature TGFβ… 2944… 10.1… ## 4 Immune_Checkpoint 2018 Nature TGFβ… 2944… 10.1… ## 5 CellCycle_Reg 2018 Nature TGFβ… 2944… 10.1… ## 6 Pan_F_TBRs 2018 Nature TGFβ… 2944… 10.1… ## 7 Histones 2018 Nature TGFβ… 2944… 10.1… ## 8 EMT1 2018 Nature TGFβ… 2944… 10.1… ## 9 EMT2 2018 Nature TGFβ… 2944… 10.1… ## 10 EMT3 2018 Nature TGFβ… 2944… 10.1… ## 11 WNT_target 2018 Nature TGFβ… 2944… 10.1… ## 12 FGFR3_related 2018 Nature TGFβ… 2944… 10.1… ## 13 Cell_cycle 2018 Nature TGFβ… 2944… 10.1… ## 14 Mismatch_Repair 2018 Nature TGFβ… 2944… 10.1… ## 15 Homologous_recombination 2018 Nature TGFβ… 2944… 10.1… ## 16 Nucleotide_excision_repair 2018 Nature TGFβ… 2944… 10.1… ## 17 DNA_replication 2018 Nature TGFβ… 2944… 10.1… ## 18 Base_excision_repair 2018 Nature TGFβ… 2944… 10.1… ## 19 TMEscoreA_CIR 2019 Cancer Immunol… Tumo… 3084… 10.1… ## 20 TMEscoreB_CIR 2019 Cancer Immunol… Tumo… 3084… 10.1… Three methodologies were adopted in the process of signature score evaluation, comprising Single-sample Gene Set Enrichment Analysis (ssGSEA), Principal component analysis (PCA), and Z-score. 4.3.2 Estimated by PCA method sig_tme&lt;-calculate_sig_score(pdata = NULL, eset = eset, signature = signature_collection, method = &quot;pca&quot;, mini_gene_count = 2) sig_tme &lt;- t(column_to_rownames(sig_tme, var = &quot;ID&quot;)) sig_tme[1:5, 1:3] ## GSM1523727 GSM1523728 GSM1523729 ## CD_8_T_effector -2.5513794 0.7789141 -2.1770675 ## DDR -0.8747614 0.7425162 -1.3272054 ## APM 1.1098368 2.1988688 -0.9516419 ## Immune_Checkpoint -2.3701787 0.9455120 -1.4844104 ## CellCycle_Reg 0.1063358 0.7583302 -0.3649795 4.3.3 Estimated by ssGSEA methodology This method is suitable for gene sets with a large number of genes, such as those of GO, KEGG, REACTOME gene sets. Figure 4.1: Gene sets of MSigDb sig_tme&lt;-calculate_sig_score(pdata = NULL, eset = eset, signature = go_bp, method = &quot;ssgsea&quot;, mini_gene_count = 2) 4.3.4 Estimated by zscore function sig_tme&lt;-calculate_sig_score(pdata = NULL, eset = eset, signature = signature_collection, method = &quot;zscore&quot;, mini_gene_count = 2) 4.3.5 Reference ssgsea: Barbie, D.A. et al (2009). Systematic RNA interference reveals that oncogenic KRAS-driven cancers require TBK1. Nature, 462(5):108-112. gsva: Hänzelmann, S., Castelo, R. and Guinney, J. (2013). GSVA: Gene set variation analysis for microarray and RNA-Seq data. BMC Bioinformatics, 14(1):7. zscore: Lee, E. et al (2008). Inferring pathway activity toward precise disease classification. PLoS Comp Biol, 4(11):e1000217. PCA method: Mariathasan S, Turley SJ, Nickles D, et al. TGFβ attenuates tumour response to PD-L1 blockade by contributing to exclusion of T cells. Nature. 2018 Feb 22;554(7693):544-548. 4.4 Identifying features associated with survival data(&quot;pdata_acrg&quot;) input &lt;- combine_pd_eset(eset = sig_tme, pdata = pdata_acrg, scale = T) res&lt;- batch_surv(pdata = input, time = &quot;OS_time&quot;, status = &quot;OS_status&quot;, variable = colnames(input)[69:ncol(input)]) head(res) ## # A tibble: 6 × 5 ## ID P HR CI_low_0.95 CI_up_0.95 ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 Folate_biosynthesis 1.00e-10 0.579 0.490 0.683 ## 2 TMEscore_CIR 1.32e- 9 0.640 0.554 0.739 ## 3 Glycogen_Biosynthesis 3.24e- 9 1.52 1.32 1.74 ## 4 Pan_F_TBRs 6.33e- 9 1.55 1.34 1.80 ## 5 TMEscoreB_CIR 7.17e- 9 1.52 1.32 1.75 ## 6 TMEscore_plus 8.08e- 9 0.638 0.547 0.743 res&lt;- res[nchar(res$ID)&lt;=28, ] p1&lt;- sig_forest(res, signature = &quot;ID&quot;, n = 20) 4.5 Visulization using heatmap Signatures和分子分型之间的关系 使用IOBR的sig_heatmap进行热图的可视化 p2 &lt;- sig_heatmap(input = input, features = res$ID[1:20], group = &quot;Subtype&quot;, palette_group = &quot;jama&quot;, palette = 6) 4.6 Focus on target signatures p1 &lt;- sig_box(data = input, signature = &quot;Glycogen_Biosynthesis&quot;, variable = &quot;Subtype&quot;, jitter = FALSE, cols = NULL, palette = &quot;jama&quot;, show_pvalue = TRUE, size_of_pvalue = 5, hjust = 1, angle_x_text = 60, size_of_font = 8) ## # A tibble: 6 × 8 ## .y. group1 group2 p p.adj p.format p.signif method ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 signature EMT MSI 5.39e-15 3.20e-14 5.4e-15 **** Wilcoxon ## 2 signature EMT MSS/TP53- 5.53e-13 2.8 e-12 5.5e-13 **** Wilcoxon ## 3 signature EMT MSS/TP53+ 1.90e-12 7.6 e-12 1.9e-12 **** Wilcoxon ## 4 signature MSI MSS/TP53- 1.14e- 3 3.4 e- 3 0.0011 ** Wilcoxon ## 5 signature MSI MSS/TP53+ 7.05e- 3 1.4 e- 2 0.0071 ** Wilcoxon ## 6 signature MSS/TP53- MSS/TP53+ 7.16e- 1 7.2 e- 1 0.7161 ns Wilcoxon p2 &lt;- sig_box(data = input, signature = &quot;Pan_F_TBRs&quot;, variable = &quot;Subtype&quot;, jitter = FALSE, cols = NULL, palette = &quot;jama&quot;, show_pvalue = TRUE, angle_x_text = 60, hjust = 1, size_of_pvalue = 5, size_of_font = 8) ## # A tibble: 6 × 8 ## .y. group1 group2 p p.adj p.format p.signif method ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 signature EMT MSI 7.98e-17 3.20e-16 &lt;2e-16 **** Wilcoxon ## 2 signature EMT MSS/TP53- 1.70e-17 1 e-16 &lt;2e-16 **** Wilcoxon ## 3 signature EMT MSS/TP53+ 2.57e-17 1.3 e-16 &lt;2e-16 **** Wilcoxon ## 4 signature MSI MSS/TP53- 1.32e- 2 4 e- 2 0.013 * Wilcoxon ## 5 signature MSI MSS/TP53+ 6.99e- 2 1.4 e- 1 0.070 ns Wilcoxon ## 6 signature MSS/TP53- MSS/TP53+ 4.02e- 1 4 e- 1 0.402 ns Wilcoxon p3 &lt;- sig_box(data = input, signature = &quot;Immune_Checkpoint&quot;, variable = &quot;Subtype&quot;, jitter = TRUE, cols = NULL, palette = &quot;jama&quot;, show_pvalue = TRUE, angle_x_text = 60, hjust = 1, size_of_pvalue = 5, size_of_font = 8) ## # A tibble: 6 × 8 ## .y. group1 group2 p p.adj p.format p.signif method ## &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; ## 1 signature EMT MSI 2.20e- 2 0.044 0.0220 * Wilcoxon ## 2 signature EMT MSS/TP53- 2.11e- 3 0.0085 0.0021 ** Wilcoxon ## 3 signature EMT MSS/TP53+ 4.03e- 1 0.4 0.4026 ns Wilcoxon ## 4 signature MSI MSS/TP53- 9.13e-10 0.0000000055 9.1e-10 **** Wilcoxon ## 5 signature MSI MSS/TP53+ 5.03e- 4 0.0025 0.0005 *** Wilcoxon ## 6 signature MSS/TP53- MSS/TP53+ 4.82e- 3 0.014 0.0048 ** Wilcoxon p1|p2|p3 4.7 Survival analysis Signature的多种分层下的生存分析 res &lt;- sig_surv_plot(input_pdata = input, signature = &quot;Glycogen_Biosynthesis&quot;, cols = NULL, palette = &quot;jco&quot;, project = &quot;ACRG&quot;, time = &quot;OS_time&quot;, status = &quot;OS_status&quot;, time_type = &quot;month&quot;, save_path = &quot;result&quot;) ## ID time status Glycogen_Biosynthesis group3 group2 bestcutoff ## 1 GSM1523727 88.73 0 -0.3612213 Middle Low Low ## 2 GSM1523728 88.23 0 -0.6926726 Low Low Low ## 3 GSM1523729 88.23 0 -0.9388531 Low Low Low ## 4 GSM1523744 105.70 0 -1.1825136 Low Low Low ## 5 GSM1523745 105.53 0 -0.3034304 Middle Low Low ## 6 GSM1523746 25.50 1 0.7517934 High High High ## [1] &quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot; res$plots Signature在预测生存上的ROC p1&lt;- roc_time(input = input, vars = &quot;Glycogen_Biosynthesis&quot;, time = &quot;OS_time&quot;, status = &quot;OS_status&quot;, time_point = c(12, 24, 36), time_type = &quot;month&quot;, palette = &quot;jama&quot;, cols = &quot;normal&quot;, seed = 1234, show_col = FALSE, path = &quot;result&quot;, main = &quot;OS&quot;, index = 1, fig.type = &quot;pdf&quot;, width = 5, height = 5.2) ## [1] &quot;&gt;&gt;&gt;-- Range of Time: &quot; ## [1] 1.0 105.7 p2&lt;- roc_time(input = input, vars = &quot;Glycogen_Biosynthesis&quot;, time = &quot;RFS_time&quot;, status = &quot;RFS_status&quot;, time_point = c(12, 24, 36), time_type = &quot;month&quot;, palette = &quot;jama&quot;, cols = &quot;normal&quot;, seed = 1234, show_col = FALSE, path = &quot;result&quot;, main = &quot;OS&quot;, index = 1, fig.type = &quot;pdf&quot;, width = 5, height = 5.2) ## [1] &quot;&gt;&gt;&gt;-- Range of Time: &quot; ## [1] 0.10 100.87 p1|p2 4.8 Batch correlation analysis 寻找与目标signature相关的基因或者signatures res &lt;- batch_cor(data = input, target = &quot;Glycogen_Biosynthesis&quot;, feature = colnames(input)[69:ncol(input)]) head(res) ## # A tibble: 6 × 6 ## sig_names p.value statistic p.adj log10pvalue stars ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt; ## 1 TMEscoreB_CIR 8.89e-42 0.678 2.27e-39 41.1 **** ## 2 Glycine__Serine_and_Threonine_M… 7.49e-40 -0.666 9.54e-38 39.1 **** ## 3 Ether_Lipid_Metabolism 3.84e-39 0.662 3.27e-37 38.4 **** ## 4 MDSC_Peng_et_al 1.13e-38 0.659 7.21e-37 37.9 **** ## 5 Glycerophospholipid_Metabolism 8.72e-38 -0.653 4.44e-36 37.1 **** ## 6 TIP_Release_of_cancer_cell_anti… 2.32e-37 -0.650 9.86e-36 36.6 **** p1&lt;- get_cor(eset = sig_tme, pdata = pdata_acrg, var1 = &quot;Glycogen_Biosynthesis&quot;, var2 = &quot;TMEscore_CIR&quot;, subtype = &quot;Subtype&quot;, palette = &quot;aaas&quot;) ## ## Spearman&#39;s rank correlation rho ## ## data: data[, var1] and data[, var2] ## S = 7282858, p-value &lt; 2.2e-16 ## alternative hypothesis: true rho is not equal to 0 ## sample estimates: ## rho ## -0.6184309 ## ## [1] &quot;&gt;&gt;&gt;--- The exact p value is: 4.78971420439895e-33&quot; ## EMT MSI MSS/TP53- MSS/TP53+ ## 46 68 107 79 p2&lt;- get_cor(eset = sig_tme, pdata = pdata_acrg, var1 = &quot;Glycogen_Biosynthesis&quot;, var2 = &quot;TGFb.myCAF&quot;, subtype = &quot;Subtype&quot;, palette = &quot;aaas&quot;) ## ## Spearman&#39;s rank correlation rho ## ## data: data[, var1] and data[, var2] ## S = 2471758, p-value &lt; 2.2e-16 ## alternative hypothesis: true rho is not equal to 0 ## sample estimates: ## rho ## 0.4507143 ## ## [1] &quot;&gt;&gt;&gt;--- The exact p value is: 2.04505761057615e-16&quot; ## EMT MSI MSS/TP53- MSS/TP53+ ## 46 68 107 79 p1|p2 feas1 &lt;- c(&quot;Glycogen_Biosynthesis&quot;, &quot;Ferroptosis&quot;) feas2 &lt;- c(&quot;Glutathione_Metabolism&quot;, &quot;TMEscore_CIR&quot;, &quot;Purine_Metabolism&quot;, &quot;ICB_resistance_Peng_et_al&quot;, &quot;Interleukins_Li_et_al&quot;, &quot;TLS_Nature&quot;) p &lt;- get_cor_matrix(data = input, feas1 = feas2, feas2 = feas1, method = &quot;pearson&quot;, font.size.star = 8, font.size = 15, fill_by_cor = FALSE, round.num = 1) 4.9 Visulization of correlations input2 &lt;- combine_pd_eset(eset = eset, pdata = input[, c(&quot;ID&quot;, &quot;Glycogen_Biosynthesis&quot;, &quot;TLS_Nature&quot;, &quot;Ferroptosis&quot;)]) feas1 &lt;- c(&quot;Glycogen_Biosynthesis&quot;,&quot;TLS_Nature&quot;, &quot;Ferroptosis&quot;) feas2 &lt;- signature_collection$CD_8_T_effector feas2 ## [1] &quot;CD8A&quot; &quot;GZMA&quot; &quot;GZMB&quot; &quot;IFNG&quot; &quot;CXCL9&quot; &quot;CXCL10&quot; &quot;PRF1&quot; &quot;TBX21&quot; p &lt;- get_cor_matrix(data = input2, feas1 = feas2, feas2 = feas1, method = &quot;pearson&quot;, scale = T, font.size.star = 8, font.size = 15, fill_by_cor = FALSE, round.num = 1) p &lt;- get_cor_matrix(data = input2, feas1 = feas2, feas2 = feas1, method = &quot;pearson&quot;, scale = T, font.size.star = 8, font.size = 15, fill_by_cor = TRUE, round.num = 2) "],["tme-deconvolution.html", "Chapter 5 TME deconvolution 5.1 Loading packages 5.2 Downloading data for example 5.3 Available Methods to Decode TME Contexture 5.4 Method 1: CIBERSORT 5.5 Method 2: EPIC 5.6 Method 3: MCPcounter 5.7 Method 4: xCELL 5.8 Method 5: ESTIMATE 5.9 Method 6: TIMER 5.10 Method 7: quanTIseq 5.11 Method 8: IPS 5.12 Combination of above deconvolution results", " Chapter 5 TME deconvolution 5.1 Loading packages Load the IOBR package in your R session after the installation is complete: library(IOBR) library(survminer) library(tidyverse) 5.2 Downloading data for example Obtaining data set from GEO Gastric cancer: GSE62254 using GEOquery R package. if (!requireNamespace(&quot;GEOquery&quot;, quietly = TRUE)) BiocManager::install(&quot;GEOquery&quot;) library(&quot;GEOquery&quot;) # NOTE: This process may take a few minutes which depends on the internet connection speed. Please wait for its completion. eset_geo&lt;-getGEO(GEO = &quot;GSE62254&quot;, getGPL = F, destdir = &quot;./&quot;) eset &lt;-eset_geo[[1]] eset &lt;-exprs(eset) eset[1:5,1:5] ## GSM1523727 GSM1523728 GSM1523729 GSM1523744 GSM1523745 ## 1007_s_at 3.2176645 3.0624323 3.0279131 2.921683 2.8456013 ## 1053_at 2.4050109 2.4394879 2.2442708 2.345916 2.4328582 ## 117_at 1.4933412 1.8067380 1.5959665 1.839822 1.8326058 ## 121_at 2.1965561 2.2812181 2.1865556 2.258599 2.1874363 ## 1255_g_at 0.8698382 0.9502466 0.8125414 1.012860 0.9441993 Annotation of genes in the expression matrix and removal of duplicate genes. library(IOBR) # Load the annotation file `anno_hug133plus2` in IOBR. head(anno_hug133plus2) ## # A tibble: 6 × 2 ## probe_id symbol ## &lt;fct&gt; &lt;fct&gt; ## 1 1007_s_at MIR4640 ## 2 1053_at RFC2 ## 3 117_at HSPA6 ## 4 121_at PAX8 ## 5 1255_g_at GUCA1A ## 6 1294_at MIR5193 # Conduct gene annotation using `anno_hug133plus2` file; If identical gene symbols exists, these genes would be ordered by the mean expression levels. The gene symbol with highest mean expression level is selected and remove others. eset&lt;-anno_eset(eset = eset, annotation = anno_hug133plus2, symbol = &quot;symbol&quot;, probe = &quot;probe_id&quot;, method = &quot;mean&quot;) eset[1:5, 1:3] ## GSM1523727 GSM1523728 GSM1523729 ## SH3KBP1 4.327974 4.316195 4.351425 ## RPL41 4.246149 4.246808 4.257940 ## EEF1A1 4.293762 4.291038 4.262199 ## COX2 4.250288 4.283714 4.270508 ## LOC101928826 4.219303 4.219670 4.213252 5.3 Available Methods to Decode TME Contexture tme_deconvolution_methods ## MCPcounter EPIC xCell CIBERSORT ## &quot;mcpcounter&quot; &quot;epic&quot; &quot;xcell&quot; &quot;cibersort&quot; ## CIBERSORT Absolute IPS ESTIMATE SVR ## &quot;cibersort_abs&quot; &quot;ips&quot; &quot;estimate&quot; &quot;svr&quot; ## lsei TIMER quanTIseq ## &quot;lsei&quot; &quot;timer&quot; &quot;quantiseq&quot; # Return available parameter options of deconvolution methods The input data is a matrix subseted from ESET of ACRG cohort, with genes in rows and samples in columns. The row name must be HGNC symbols and the column name must be sample names. eset_acrg &lt;- eset[, 1:50] eset_acrg[1:5, 1:3] ## GSM1523727 GSM1523728 GSM1523729 ## SH3KBP1 4.327974 4.316195 4.351425 ## RPL41 4.246149 4.246808 4.257940 ## EEF1A1 4.293762 4.291038 4.262199 ## COX2 4.250288 4.283714 4.270508 ## LOC101928826 4.219303 4.219670 4.213252 Check detail parameters of the function # help(deconvo_tme) 5.4 Method 1: CIBERSORT cibersort&lt;-deconvo_tme(eset = eset_acrg, method = &quot;cibersort&quot;, arrays = TRUE, perm = 100 ) ## ## &gt;&gt;&gt; Running CIBERSORT # head(cibersort) res&lt;-cell_bar_plot(input = cibersort[1:12,], title = &quot;CIBERSORT Cell Fraction&quot;) ## There are seven categories you can choose: box, continue2, continue, random, heatmap, heatmap3, tidyheatmap ## &gt;&gt;&gt;&gt;=== Palette option for random: 1: palette1; 2: palette2; 3: palette3; 4: palette4 5.5 Method 2: EPIC # help(deconvo_epic) epic&lt;-deconvo_tme(eset = eset_acrg, method = &quot;epic&quot;, arrays = TRUE) ## ## &gt;&gt;&gt; Running EPIC ## Warning in IOBR::EPIC(bulk = eset, reference = ref, mRNA_cell = NULL, scaleExprs = TRUE): The optimization didn&#39;t fully converge for some samples: ## GSM1523744; GSM1523746; GSM1523781; GSM1523786 ## - check fit.gof for the convergeCode and convergeMessage ## Warning in IOBR::EPIC(bulk = eset, reference = ref, mRNA_cell = NULL, scaleExprs ## = TRUE): mRNA_cell value unknown for some cell types: CAFs, Endothelial - using ## the default value of 0.4 for these but this might bias the true cell proportions ## from all cell types. head(epic) ## # A tibble: 6 × 9 ## ID Bcells_EPIC CAFs_EPIC CD4_Tcells_EPIC CD8_Tcells_EPIC Endothelial_EPIC ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 GSM152… 0.0292 0.00888 0.145 0.0756 0.0876 ## 2 GSM152… 0.0293 0.0109 0.159 0.0745 0.0954 ## 3 GSM152… 0.0308 0.0106 0.149 0.0732 0.0941 ## 4 GSM152… 0.0273 0.0108 0.145 0.0704 0.0860 ## 5 GSM152… 0.0280 0.0111 0.151 0.0707 0.0928 ## 6 GSM152… 0.0320 0.00958 0.148 0.0716 0.0907 ## # ℹ 3 more variables: Macrophages_EPIC &lt;dbl&gt;, NKcells_EPIC &lt;dbl&gt;, ## # otherCells_EPIC &lt;dbl&gt; 5.6 Method 3: MCPcounter mcp&lt;-deconvo_tme(eset = eset_acrg, method = &quot;mcpcounter&quot;) ## ## &gt;&gt;&gt; Running MCP-counter head(mcp) ## # A tibble: 6 × 11 ## ID T_cells_MCPcounter CD8_T_cells_MCPcounter Cytotoxic_lymphocytes_M…¹ ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 GSM1523727 1.47 1.11 1.33 ## 2 GSM1523728 1.53 1.05 1.60 ## 3 GSM1523729 1.47 1.07 1.37 ## 4 GSM1523744 1.46 1.02 1.44 ## 5 GSM1523745 1.51 1.10 1.49 ## 6 GSM1523746 1.51 0.992 1.40 ## # ℹ abbreviated name: ¹​Cytotoxic_lymphocytes_MCPcounter ## # ℹ 7 more variables: B_lineage_MCPcounter &lt;dbl&gt;, NK_cells_MCPcounter &lt;dbl&gt;, ## # Monocytic_lineage_MCPcounter &lt;dbl&gt;, ## # Myeloid_dendritic_cells_MCPcounter &lt;dbl&gt;, Neutrophils_MCPcounter &lt;dbl&gt;, ## # Endothelial_cells_MCPcounter &lt;dbl&gt;, Fibroblasts_MCPcounter &lt;dbl&gt; 5.7 Method 4: xCELL xcell&lt;-deconvo_tme(eset = eset_acrg, method = &quot;xcell&quot;, arrays = TRUE) head(xcell) ## # A tibble: 6 × 68 ## ID aDC_xCell Adipocytes_xCell Astrocytes_xCell `B-cells_xCell` ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 GSM1523727 4.78e-19 0.0250 0 0 ## 2 GSM1523728 9.41e- 2 0.00433 7.70e- 3 0 ## 3 GSM1523729 1.02e- 1 0.0789 2.04e- 2 0 ## 4 GSM1523744 7.88e- 2 0.0538 4.82e-18 0.0126 ## 5 GSM1523745 9.02e- 2 0.0136 1.93e- 2 0 ## 6 GSM1523746 3.40e- 2 0.0331 9.22e- 2 0 ## # ℹ 63 more variables: Basophils_xCell &lt;dbl&gt;, ## # `CD4+_memory_T-cells_xCell` &lt;dbl&gt;, `CD4+_naive_T-cells_xCell` &lt;dbl&gt;, ## # `CD4+_T-cells_xCell` &lt;dbl&gt;, `CD4+_Tcm_xCell` &lt;dbl&gt;, `CD4+_Tem_xCell` &lt;dbl&gt;, ## # `CD8+_naive_T-cells_xCell` &lt;dbl&gt;, `CD8+_T-cells_xCell` &lt;dbl&gt;, ## # `CD8+_Tcm_xCell` &lt;dbl&gt;, `CD8+_Tem_xCell` &lt;dbl&gt;, cDC_xCell &lt;dbl&gt;, ## # Chondrocytes_xCell &lt;dbl&gt;, `Class-switched_memory_B-cells_xCell` &lt;dbl&gt;, ## # CLP_xCell &lt;dbl&gt;, CMP_xCell &lt;dbl&gt;, DC_xCell &lt;dbl&gt;, … 5.8 Method 5: ESTIMATE estimate&lt;-deconvo_tme(eset = eset_acrg, method = &quot;estimate&quot;) ## [1] &quot;Merged dataset includes 9940 genes (472 mismatched).&quot; ## [1] &quot;1 gene set: StromalSignature overlap= 136&quot; ## [1] &quot;2 gene set: ImmuneSignature overlap= 138&quot; head(estimate) ## # A tibble: 6 × 5 ## ID StromalScore_estimate ImmuneScore_estimate ESTIMATEScore_estimate ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 GSM1523727 -1250. 268. -982. ## 2 GSM1523728 197. 1334. 1531. ## 3 GSM1523729 -111. 822. 711. ## 4 GSM1523744 -119. 662. 544. ## 5 GSM1523745 324. 1015. 1339. ## 6 GSM1523746 -594. 621. 27.0 ## # ℹ 1 more variable: TumorPurity_estimate &lt;dbl&gt; 5.9 Method 6: TIMER timer&lt;-deconvo_tme(eset = eset_acrg, method = &quot;timer&quot;, group_list = rep(&quot;stad&quot;,dim(eset_acrg)[2])) ## [1] &quot;Outlier genes: AGR2 B2M COL1A2 COL3A1 COX2 CYAT1 EEF1A1 EIF1 FTH1 GKN1 HUWE1 IGK IGLC1 LIPF LOC101060363 LOC101928826 MIR8071-2 ND4 PABPC1 PABPC3 PGA4 RPL13AP5 RPL37 RPL37A RPL41 RPL7 RPS10 RPS16 RPS17 RPS18 RPS19 S100A6 S100A9 SH3KBP1 SNORD24 SNORD42A SNORD54 SNORD73A SPINK1 SPINK4 TFF1 UQCRFS1&quot; head(timer) ## # A tibble: 6 × 7 ## ID B_cell_TIMER T_cell_CD4_TIMER T_cell_CD8_TIMER Neutrophil_TIMER ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 GSM1523727 0.104 0.128 0.183 0.108 ## 2 GSM1523728 0.103 0.130 0.192 0.118 ## 3 GSM1523729 0.106 0.130 0.190 0.110 ## 4 GSM1523744 0.101 0.126 0.187 0.111 ## 5 GSM1523745 0.104 0.127 0.191 0.116 ## 6 GSM1523746 0.105 0.129 0.192 0.111 ## # ℹ 2 more variables: Macrophage_TIMER &lt;dbl&gt;, DC_TIMER &lt;dbl&gt; 5.10 Method 7: quanTIseq quantiseq&lt;-deconvo_tme(eset = eset_acrg, tumor = TRUE, arrays = TRUE, scale_mrna = TRUE, method = &quot;quantiseq&quot;) ## ## Running quanTIseq deconvolution module ## Gene expression normalization and re-annotation (arrays: TRUE) ## Removing 17 genes with high expression in tumors ## Signature genes found in data set: 152/153 (99.35%) ## Mixture deconvolution (method: lsei) ## Deconvolution sucessful! head(quantiseq) ## # A tibble: 6 × 12 ## ID B_cells_quantiseq Macrophages_M1_quantiseq Macrophages_M2_quantiseq ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 GSM1523727 0.0983 0.0510 0.0598 ## 2 GSM1523728 0.0967 0.0795 0.0607 ## 3 GSM1523729 0.102 0.0450 0.0758 ## 4 GSM1523744 0.0954 0.0725 0.0579 ## 5 GSM1523745 0.0991 0.0669 0.0613 ## 6 GSM1523746 0.105 0.0453 0.0662 ## # ℹ 8 more variables: Monocytes_quantiseq &lt;dbl&gt;, Neutrophils_quantiseq &lt;dbl&gt;, ## # NK_cells_quantiseq &lt;dbl&gt;, T_cells_CD4_quantiseq &lt;dbl&gt;, ## # T_cells_CD8_quantiseq &lt;dbl&gt;, Tregs_quantiseq &lt;dbl&gt;, ## # Dendritic_cells_quantiseq &lt;dbl&gt;, Other_quantiseq &lt;dbl&gt; res&lt;-cell_bar_plot(input = quantiseq[1:12, ], title = &quot;quanTIseq Cell Fraction&quot;) ## There are seven categories you can choose: box, continue2, continue, random, heatmap, heatmap3, tidyheatmap ## &gt;&gt;&gt;&gt;=== Palette option for random: 1: palette1; 2: palette2; 3: palette3; 4: palette4 5.11 Method 8: IPS ips&lt;-deconvo_tme(eset = eset_acrg, method = &quot;ips&quot;, plot= FALSE) head(ips) ## # A tibble: 6 × 7 ## ID MHC_IPS EC_IPS SC_IPS CP_IPS AZ_IPS IPS_IPS ## &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; ## 1 GSM1523727 2.25 0.404 -0.192 0.220 2.68 9 ## 2 GSM1523728 2.37 0.608 -0.578 -0.234 2.17 7 ## 3 GSM1523729 2.10 0.480 -0.322 0.0993 2.36 8 ## 4 GSM1523744 2.12 0.535 -0.333 0.0132 2.34 8 ## 5 GSM1523745 1.91 0.559 -0.479 0.0880 2.08 7 ## 6 GSM1523746 1.94 0.458 -0.346 0.261 2.31 8 5.12 Combination of above deconvolution results tme_combine&lt;-cibersort %&gt;% inner_join(.,mcp,by = &quot;ID&quot;) %&gt;% inner_join(.,xcell,by = &quot;ID&quot;) %&gt;% inner_join(.,epic,by = &quot;ID&quot;) %&gt;% inner_join(.,estimate,by = &quot;ID&quot;) %&gt;% inner_join(.,timer,by = &quot;ID&quot;) %&gt;% inner_join(.,quantiseq,by = &quot;ID&quot;) %&gt;% inner_join(.,ips,by = &quot;ID&quot;) dim(tme_combine) ## [1] 50 138 If you use this package in your work, please cite both our package and the method(s) you are using. Citation and licenses of these deconvolution methods CIBERSORT; free for non-commerical use only; Newman, A. M., Liu, C. L., Green, M. R., Gentles, A. J., Feng, W., Xu, Y., … Alizadeh, A. A. (2015). Robust enumeration of cell subsets from tissue expression profiles. Nature Methods, 12(5), 453–457. https://doi.org/10.1038/nmeth.3337; ESTIMATE; free (GPL2.0); Vegesna R, Kim H, Torres-Garcia W, …, Verhaak R. (2013). Inferring tumour purity and stromal and immune cell admixture from expression data. Nature Communications 4, 2612. http://doi.org/10.1038/ncomms3612; quanTIseq; free (BSD); Finotello, F., Mayer, C., Plattner, C., Laschober, G., Rieder, D., Hackl, H., …, Sopper, S. (2019). Molecular and pharmacological modulators of the tumor immune contexture revealed by deconvolution of RNA-seq data. Genome medicine, 11(1), 34. https://doi.org/10.1186/s13073-019-0638-6; TIMER; free (GPL 2.0); Li, B., Severson, E., Pignon, J.-C., Zhao, H., Li, T., Novak, J., … Liu, X. S. (2016). Comprehensive analyses of tumor immunity: implications for cancer immunotherapy. Genome Biology, 17(1), 174. https://doi.org/10.1186/s13059-016-1028-7; IPS; free (BSD); P. Charoentong et al., Pan-cancer Immunogenomic Analyses Reveal Genotype-Immunophenotype Relationships and Predictors of Response to Checkpoint Blockade. Cell Reports 18, 248-262 (2017). https://doi.org/10.1016/j.celrep.2016.12.019; MCPCounter; free (GPL 3.0); Becht, E., Giraldo, N. A., Lacroix, L., Buttard, B., Elarouci, N., Petitprez, F., … de Reyniès, A. (2016). Estimating the population abundance of tissue-infiltrating immune and stromal cell populations using gene expression. Genome Biology, 17(1), 218. https://doi.org/10.1186/s13059-016-1070-5; xCell; free (GPL 3.0); Aran, D., Hu, Z., &amp; Butte, A. J. (2017). xCell: digitally portraying the tissue cellular heterogeneity landscape. Genome Biology, 18(1), 220. https://doi.org/10.1186/s13059-017-1349-1; EPIC; free for non-commercial use only (Academic License); Racle, J., de Jonge, K., Baumgaertner, P., Speiser, D. E., &amp; Gfeller, D. (2017). Simultaneous enumeration of cancer and immune cell types from bulk tumor gene expression data. ELife, 6, e26476. https://doi.org/10.7554/eLife.26476; GSVA free (GPL (&gt;= 2)) Hänzelmann S, Castelo R, Guinney J (2013). “GSVA: gene set variation analysis for microarray and RNA-Seq data.” BMC Bioinformatics, 14, 7. doi: 10.1186/1471-2105-14-7, http://www.biomedcentral.com/1471-2105/14/7 "],["references-1.html", "Chapter 6 References 6.1 TME deconvolution 6.2 TME Signatures 6.3 Data sets 6.4 Others", " Chapter 6 References If IOBR R package is utilized in your published research, please cite: Zeng D, Ye Z, Shen R, Yu G, Wu J, Xiong Y,…, Liao W (2021) IOBR: Multi-Omics Immuno-Oncology Biological Research to Decode Tumor Microenvironment and Signatures. Frontiers in Immunology. 12:687975. doi: 10.3389/fimmu.2021.687975 6.1 TME deconvolution Please cite the following papers appropriately for TME deconvolution algorithm if used: CIBERSORT: Newman, A. M., Liu, C. L., Green, M. R., Gentles, A. J., Feng, W., Xu, Y., … Alizadeh, A. A. (2015). Robust enumeration of cell subsets from tissue expression profiles. Nature Methods, 12(5), 453–457. https://doi.org/10.1038/nmeth.3337 ESTIMATE: Vegesna R, Kim H, Torres-Garcia W, …, Verhaak R.*(2013). Inferring tumour purity and stromal and immune cell admixture from expression data. Nature Communications 4, 2612. http://doi.org/10.1038/ncomms3612 quanTIseq: Finotello, F., Mayer, C., Plattner, C., Laschober, G., Rieder, D., Hackl, H., …, Sopper, S.* (2019). Molecular and pharmacological modulators of the tumor immune contexture revealed by deconvolution of RNA-seq data. Genome medicine, 11(1), 34. https://doi.org/10.1186/s13073-019-0638-6 TIMER: Li, B., Severson, E., Pignon, J.-C., Zhao, H., Li, T., Novak, J., … Liu, X. S.* (2016). Comprehensive analyses of tumor immunity: implications for cancer immunotherapy. Genome Biology, 17(1), 174. IPS: P. Charoentong et al.*, Pan-cancer Immunogenomic Analyses Reveal Genotype-Immunophenotype Relationships and Predictors of Response to Checkpoint Blockade. Cell Reports 18, 248-262 (2017). https://doi.org/10.1016/j.celrep.2016.12.019 MCPCounter: Becht, E., Giraldo, N. A., Lacroix, L., Buttard, B., Elarouci, N., Petitprez, F., … de Reyniès, A*. (2016). Estimating the population abundance of tissue-infiltrating immune and stromal cell populations using gene expression. Genome Biology, 17(1), 218. https://doi.org/10.1186/s13059-016-1070-5 xCell: Aran, D., Hu, Z., &amp; Butte, A. J.* (2017). xCell: digitally portraying the tissue cellular heterogeneity landscape. Genome Biology, 18(1), 220. https://doi.org/10.1186/s13059-017-1349-1 EPIC: Racle, J., de Jonge, K., Baumgaertner, P., Speiser, D. E., &amp; Gfeller, D*. (2017). Simultaneous enumeration of cancer and immune cell types from bulk tumor gene expression data. ELife, 6, e26476. https://doi.org/10.7554/eLife.26476 6.2 TME Signatures For signature score estimation, please cite corresponding literature below: ssgsea: Barbie, D.A. et al (2009). Systematic RNA interference reveals that oncogenic KRAS-driven cancers require TBK1. Nature, 462(5):108-112. gsva: Hänzelmann, S., Castelo, R. and Guinney, J. (2013). GSVA: Gene set variation analysis for microarray and RNA-Seq data. BMC Bioinformatics, 14(1):7. zscore: Lee, E. et al (2008). Inferring pathway activity toward precise disease classification. PLoS Comp Biol, 4(11):e1000217. 6.3 Data sets For the datasets enrolled in IOBR, please cite the data sources: UCSCXena: Wang et al.,et al (2019). The UCSCXenaTools R package: a toolkit for accessing genomics data from UCSC Xena platform, from cancer multi-omics to single-cell RNA-seq. Journal of Open Source Software, 4(40), 1627 TLSscore: Helmink BA, Reddy SM, Gao J, et al. B cells and tertiary lymphoid structures promote immunotherapy response. Nature. 2020 Jan;577(7791):549-555. IMvigor210 immuntherapy cohort: Mariathasan S, Turley SJ, Nickles D, et al. TGFβ attenuates tumour response to PD-L1 blockade by contributing to exclusion of T cells. Nature. 2018 Feb 22;554(7693):544-548. HCP5: Kulski, J.K. Long Noncoding RNA HCP5, a Hybrid HLA Class I Endogenous Retroviral Gene: Structure, Expression, and Disease Associations. Cells 2019, 8, 480. HCP5: Li, Y., Jiang, T., Zhou, W. et al. Pan-cancer characterization of immune-related lncRNAs identifies potential oncogenic biomarkers. Nat Commun 11, 1000 (2020). HCP5: Sun J, Zhang Z, Bao S, et alIdentification of tumor immune infiltration-associated lncRNAs for improving prognosis and immunotherapy response of patients with non-small cell lung cancerJournal for ImmunoTherapy of Cancer 2020;8:e000110. LINC00657: Feng Q, Zhang H, Yao D, Chen WD, Wang YD. Emerging Role of Non-Coding RNAs in Esophageal Squamous Cell Carcinoma. Int J Mol Sci. 2019 Dec 30;21(1):258. doi: 10.3390/ijms21010258. LINC00657: Qin X, Zhou M, Lv H, Mao X, Li X, Guo H, Li L, Xing H. Long noncoding RNA LINC00657 inhibits cervical cancer development by sponging miR-20a-5p and targeting RUNX3. Cancer Lett. 2020 Oct 28:S0304-3835(20)30578-4. doi: 10.1016/j.canlet.2020.10.044. LINC00657: Zhang XM, Wang J, Liu ZL, Liu H, Cheng YF, Wang T. LINC00657/miR-26a-5p/CKS2 ceRNA network promotes the growth of esophageal cancer cells via the MDM2/p53/Bcl2/Bax pathway. Biosci Rep. 2020;40(6):BSR20200525. TCGA-STAD: Cancer Genome Atlas Research Network. Comprehensive molecular characterization of gastric adenocarcinoma. Nature. 2014 Sep 11;513(7517):202-9. doi: 10.1038/nature13480. TCGA.STAD MAF data: https://api.gdc.cancer.gov/data/c06465a3-50e7-46f7-b2dd-7bd654ca206b 6.4 Others Newman, A. M., Liu, C. L., Green, M. R., Gentles, A. J., Feng, W., Xu, Y., … Alizadeh, A. A. (2015). Robust enumeration of cell subsets from tissue expression profiles. Nature Methods, 12(5), 453–457. Vegesna R, Kim H, Torres-Garcia W, …, Verhaak R.*(2013). Inferring tumour purity and stromal and immune cell admixture from expression data. Nature Communications 4, 2612. Rieder, D., Hackl, H., …, Sopper, S.* (2019). Molecular and pharmacological modulators of the tumor immune contexture revealed by deconvolution of RNA-seq data. Genome medicine, 11(1), 34. Li, B., Severson, E., Pignon, J.-C., Zhao, H., Li, T., Novak, J., … Liu, X. S.* (2016). Comprehensive analyses of tumor immunity: implications for cancer immunotherapy. Genome Biology, 17(1), 174. P. Charoentong et al.*, Pan-cancer Immunogenomic Analyses Reveal Genotype-Immunophenotype Relationships and Predictors of Response to Checkpoint Blockade. Cell Reports 18, 248-262 (2017). Becht, E., Giraldo, N. A., Lacroix, L., Buttard, B., Elarouci, N., Petitprez, F., … de Reyniès, A*. (2016). Estimating the population abundance of tissue-infiltrating immune and stromal cell populations using gene expression. Genome Biology, 17(1), 218. Aran, D., Hu, Z., &amp; Butte, A. J.* (2017). xCell: digitally portraying the tissue cellular heterogeneity landscape. Genome Biology, 18(1), 220. Racle, J., de Jonge, K., Baumgaertner, P., Speiser, D. E., &amp; Gfeller, D*. (2017). Simultaneous enumeration of cancer and immune cell types from bulk tumor gene expression data. ELife, 6, e26476. Barbie, D.A. et al (2009). Systematic RNA interference reveals that oncogenic KRAS-driven cancers require TBK1. Nature, 462(5):108-112. Hänzelmann, S., Castelo, R. and Guinney, J. (2013). GSVA: Gene set variation analysis for microarray and RNA-Seq data. BMC Bioinformatics, 14(1):7. Lee, E. et al (2008). Inferring pathway activity toward precise disease classification. PLoS Comp Biol, 4(11):e1000217. Wang et al.,et al (2019). The UCSCXenaTools R package: a toolkit for accessing genomics data from UCSC Xena platform, from cancer multi-omics to single-cell RNA-seq. Journal of Open Source Software, 4(40), 1627 Helmink BA, Reddy SM, Gao J, et al. B cells and tertiary lymphoid structures promote immunotherapy response. Nature. 2020 Jan;577(7791):549-555. Mariathasan S, Turley SJ, Nickles D, et al. TGFβ attenuates tumour response to PD-L1 blockade by contributing to exclusion of T cells. Nature. 2018 Feb 22;554(7693):544-548. Kulski, J.K. Long Noncoding RNA HCP5, a Hybrid HLA Class I Endogenous Retroviral Gene: Structure, Expression, and Disease Associations. Cells 2019, 8, 480. Li, Y., Jiang, T., Zhou, W. et al. Pan-cancer characterization of immune-related lncRNAs identifies potential oncogenic biomarkers. Nat Commun 11, 1000 (2020). Sun J, Zhang Z, Bao S, et alIdentification of tumor immune infiltration-associated lncRNAs for improving prognosis and immunotherapy response of patients with non-small cell lung cancerJournal for ImmunoTherapy of Cancer 2020;8:e000110. Feng Q, Zhang H, Yao D, Chen WD, Wang YD. Emerging Role of Non-Coding RNAs in Esophageal Squamous Cell Carcinoma. Int J Mol Sci. 2019 Dec 30;21(1):258. doi: 10.3390/ijms21010258. Qin X, Zhou M, Lv H, Mao X, Li X, Guo H, Li L, Xing H. Long noncoding RNA LINC00657 inhibits cervical cancer development by sponging miR-20a-5p and targeting RUNX3. Cancer Lett. 2020 Oct Zhang XM, Wang J, Liu ZL, Liu H, Cheng YF, Wang T. LINC00657/miR-26a-5p/CKS2 ceRNA network promotes the growth of esophageal cancer cells via the MDM2/p53/Bcl2/Bax pathway. Biosci Rep. 2020;40(6):BSR20200525. Cancer Genome Atlas Research Network. Comprehensive molecular characterization of gastric adenocarcinoma. Nature. 2014 Sep 11;513(7517):202-9. doi: 10.1038/nature13480. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
